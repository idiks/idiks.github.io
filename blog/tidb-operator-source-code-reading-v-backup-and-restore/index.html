<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<script>
window.ga =
    window.ga ||
    function() {
        ;(ga.q = ga.q || []).push(arguments)
    }
ga.l = +new Date()
ga('create', 'UA-99991864-4', 'auto')
ga('send', 'pageview')
</script>
<script async src="https://static.idiks.com/js/ga-analytics.js"></script>



<link rel="stylesheet" href="https://static.idiks.com/style/github-markdown.css">


<link rel="stylesheet" href="/css/doc.css">

    
    <title>TiDB Operator Source Code Reading (V): Backup and Restore |&nbsp;TiDB</title><link rel="icon" href="/images/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<meta name="description" content="This post explains the design and implementation of the backup and restore features provided by TiDB Operator. You&#39;ll learn about the core logic of three related controllers and the backup-manager.">
<meta name="robots" content="noodp">
<meta name="keywords" content="TiDB, MySQL, HTAP, Open Source, Cloud-Native, NewSQL, Aurora Alternative">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="website">
<meta property="og:title" content="TiDB Operator Source Code Reading (V): Backup and Restore | TiDB">
<meta property="og:description" content="This post explains the design and implementation of the backup and restore features provided by TiDB Operator. You&#39;ll learn about the core logic of three related controllers and the backup-manager.">
<meta property="og:url" content="https://idiks.com/blog/tidb-operator-source-code-reading-v-backup-and-restore/">
<meta property="og:site_name" content="MySQL at Scale. No more manual sharding">
<meta property="og:image" content="/images/blog/tidb-operator-source-code-reading-v-backup-and-restore.jpg">
<meta property="og:image:secure_url" content="/images/blog/tidb-operator-source-code-reading-v-backup-and-restore.jpg"><meta name="twitter:card" content="summary_large_image">
<meta name="og:image:width" content="1200">
<meta name="og:image:height" content="600"><meta name="twitter:description" content="This post explains the design and implementation of the backup and restore features provided by TiDB Operator. You&#39;ll learn about the core logic of three related controllers and the backup-manager.">
<meta name="twitter:title" content="TiDB Operator Source Code Reading (V): Backup and Restore | TiDB">
<meta name="twitter:site" content="@pingcap">
<meta name="twitter:image" content="https://static.idiks.com/images/blog/tidb-operator-source-code-reading-v-backup-and-restore.jpg"><meta name="twitter:creator" content="@pingcap">





<script type="application/ld+json">
{
    "@context": "http:\/\/schema.org",
    "@type": "WebSite",
    "url": "https:\/\/pingcap.com\/",
    "name": "PingCAP",
    "potentialAction": {
        "@type": "SearchAction",
        "target": "https:\/\/pingcap.com\/?s={search_term_string}",
        "query-input": "required name=search_term_string"
    }
}
</script>


<script>
    (function(){
        var bp = document.createElement('script');
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>


<script type="text/javascript" async src="https://accounts.pingcap.com/static/pingcap_sso/js/track.beta.js"></script>
    
<link rel="preload" href="https://static.idiks.com/fonts/lato/lato-regular-webfont.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/lato/lato-regular-webfont.woff" as="font" type="font/woff" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/lato/lato-regular-webfont.ttf" as="font" type="font/ttf" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/titilliumweb/titilliumweb-regular-webfont.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/titilliumweb/titilliumweb-regular-webfont.woff" as="font" type="font/woff" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/titilliumweb/titilliumweb-regular-webfont.ttf" as="font" type="font/ttf" crossorigin="anonymous">

<link rel="preload" href="https://static.idiks.com/js/jquery.min.js" as="script">


<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="https://static.idiks.com/style/docsearch.min.css">
<script type="text/javascript">
var trackOutboundLink = function(url) {
  var redirectTriggered = false
  ga('send', 'event', 'outbound', 'click', url, {
    hitCallback: function() {
      redirectTriggered = true
      document.location = url
    }
  })
  setTimeout(function() {
    if (!redirectTriggered) {
      document.location = url
    }
  }, 1500)
}

var trackViews = function(btn_type, event_category) {
  var event_label = btn_type
  var eventCategory = event_category
  ga('send', 'event', {
    'eventCategory': eventCategory,
    'eventAction': 'click',
    'eventLabel': event_label,
    'transport': 'beacon'
  });
}
</script>
<script>if (location.pathname === '/') {
        if (location.hostname === 'idiks.github.io') {
            location.href = '/en/'
        }
    }</script></head>       <body data-lang="en" ><div id="page-content">

<header role="navigation" class="fixed-top">
    <div class="container">
        <a class="nav-brand" href="/en"><img src="/images/pingcap-logo.png" alt="PingCAP"></a>
        <div class="nav-wrapper">
            <div class="navigation">
                <ul>
                <li ><a class="a-en" href="https://idiks.com">Cloud</a></li>
                <li ><a class="a-en" class="tidb-academy"
                    href="/tidb-academy">iDIKS Academy</a></li>
                <li class="docs-type-selector " id="docsTypeSelector">
                    <a class="header-doc-nav" href="#">Docs</a>
                    <div class="header-dropdown-menu" id="docsTypeSelectorItem">
                        <a class="header-dropdown-item" href="/docs/stable/">TiDB</a>
                        <a class="header-dropdown-item" href="/docs/tidb-in-kubernetes/stable/">TiDB in Kubernetes</a>
                        <a class="header-dropdown-item" href="/docs/tidb-data-migration/stable/">TiDB Data Migration (DM)</a>
                    </div>
                </li>
                
                <li ><a class="a-en" href="/success-stories">Success
                    Stories</a></li>
                <li class="sel" ><a class="a-en" href="/blog">Blog</a></li>
                <li ><a class="link-download link-download-en" href="/download">Free Download</a></li>
                </ul>
            </div>
            <div class="global-search">
                
                
                
                <div class="search-wrapper">
    <span class="icon-search"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#fff" viewBox="0 0 67.125 67.125"><path d="M23.902 0C11.01 0 .523 10.488.523 23.38c0 12.891 10.487 23.379 23.379 23.379a23.258 23.258 0 0 0 14.471-5.037l24.816 24.817c.391.391.902.586 1.414.586s1.023-.195 1.414-.586a2 2 0 0 0 0-2.828L41.293 38.985c3.721-4.142 5.989-9.613 5.989-15.605C47.282 10.488 36.794 0 23.902 0zM4.523 23.38C4.523 12.694 13.216 4 23.902 4c10.687 0 19.38 8.694 19.38 19.38 0 5.396-2.221 10.279-5.791 13.795a1.959 1.959 0 0 0-.488.349 2.003 2.003 0 0 0-.271.343C33.31 40.9 28.825 42.76 23.903 42.76c-10.686-.001-19.38-8.695-19.38-19.38z"/><path d="M24.075 8.591c-8.25 0-14.962 6.712-14.962 14.962a2 2 0 0 0 4 0c0-6.044 4.918-10.962 10.962-10.962a2 2 0 0 0 0-4z"/></svg></span>
    <input data-lang="en" data-type="" type="search" id="search-input" name="q"
        placeholder="Search TiDB Docs">
</div>

<script>
    const inputNode = document.getElementById("search-input")

    inputNode.addEventListener('keyup', ({key}) => {
        if (key === "Enter") {
            if ($('#search-input').data('lang') == 'cn') {
                lang = 'zh'
            }

            const query = $('#search-input').val()
            if (query) {
                url = "https://idiks.com/docs" + (lang == 'zh' ? 'zh/' : '') + "search/?lang=" + lang + "&type=tidb&version=v4.0&q=" + query
                window.location.href = url
            }
        }
    })
</script>

            </div>
        </div>
        <div class="nav-btn nav-slider">
            <i class="material-icons"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 459 459"><path d="M0 382.5h459v-51H0v51zM0 255h459v-51H0v51zM0 76.5v51h459v-51H0z" fill="#FFF"/></svg></i>
        </div>
    </div>
</header>



<nav class="mobile-sidebar">
    <div class="nav-header">
        <div class="logo-wrap">
        <a class="nav-brand" href="/en"><img src="/images/pingcap-logo.png" alt="PingCAP"></a>
        </div>
    </div>
    <ul class="ul-base">
        <li ><a href="https://idiks.com/">Cloud</a></li>
        <li ><a class="tidb-academy" href="/tidb-academy">TiDB Academy</a></li>
        <li class="docs-type-selector " id="docsTypeSelector">
            <p class="header-doc-nav">Docs</p>
            <div class="header-dropdown-menu" id="docsTypeSelectorItem">
                <a class="header-dropdown-item" href="/docs/stable/">TiDB</a>
                <a class="header-dropdown-item" href="/docs/tidb-in-kubernetes/stable/">TiDB in Kubernetes</a>
                <a class="header-dropdown-item" href="/docs/tidb-data-migration/stable/">TiDB Data Migration (DM)</a>
            </div>
        </li>
        <li ><a href="/success-stories">Success Stories</a></li>
        <li class="sel"><a href="/blog">Blog</a></li>
        <li><a class="link-download" href="/download">Free Download</a></li>
    </ul>
    <div class="nav-footer">
        <div class="contact-list-wrap">
        <div class="flex-list">
            <h4 class="list-title"><strong>Contact</strong></h4>
            <ul class="social ul-base">
            <li><a href="https://twitter.com/PingCAP" class="twitter" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" width="18" height="18"><path d="M612 116.258a250.714 250.714 0 0 1-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 0 1-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"/></svg></a></li>
            <li><a href="https://www.linkedin.com/company/pingcap/" class="linkedin" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 438.536 438.535"><path d="M5.424 145.895H99.64v282.932H5.424zM408.842 171.739c-19.791-21.604-45.967-32.408-78.512-32.408-11.991 0-22.891 1.475-32.695 4.427-9.801 2.95-18.079 7.089-24.838 12.419-6.755 5.33-12.135 10.278-16.129 14.844-3.798 4.337-7.512 9.389-11.136 15.104v-40.232h-93.935l.288 13.706c.193 9.139.288 37.307.288 84.508 0 47.205-.19 108.777-.572 184.722h93.931V270.942c0-9.705 1.041-17.412 3.139-23.127 4-9.712 10.037-17.843 18.131-24.407 8.093-6.572 18.13-9.855 30.125-9.855 16.364 0 28.407 5.662 36.117 16.987 7.707 11.324 11.561 26.98 11.561 46.966V428.82h93.931V266.664c-.007-41.688-9.897-73.328-29.694-94.925zM53.103 9.708c-15.796 0-28.595 4.619-38.4 13.848C4.899 32.787 0 44.441 0 58.529 0 72.42 4.758 84.034 14.275 93.358c9.514 9.325 22.078 13.99 37.685 13.99h.571c15.99 0 28.887-4.661 38.688-13.99 9.801-9.324 14.606-20.934 14.417-34.829-.19-14.087-5.047-25.742-14.561-34.973C81.562 14.323 68.9 9.708 53.103 9.708z"/></svg></a></li>
            <li><a href="https://www.reddit.com/r/TiDB/" class="reddit" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 279.748 279.748" width="18" height="18"><path d="M279.748 133.142c0-19.299-15.701-35-35-35-10.768 0-20.674 4.812-27.279 13.064-18.532-8.431-39.663-13.626-62.015-15.271l19.206-60.692 42.895 9.294c3.285 12.782 14.901 22.258 28.693 22.258 16.336 0 29.627-13.29 29.627-29.626 0-16.336-13.291-29.627-29.627-29.627-11.801 0-21.999 6.941-26.759 16.95l-49.497-10.725a10.002 10.002 0 0 0-11.651 6.756L134.636 95.43c-26.164.638-50.988 6.053-72.356 15.775-6.606-8.251-16.512-13.063-27.28-13.063-19.299 0-35 15.701-35 35 0 9.373 3.683 18.173 10.222 24.709-3.9 8.37-5.875 17.076-5.875 25.936 0 24.048 14.396 46.492 40.538 63.199 25.447 16.264 59.183 25.221 94.989 25.221 35.808 0 69.542-8.957 94.989-25.221 26.142-16.707 40.538-39.151 40.538-63.199 0-8.859-1.975-17.565-5.875-25.936 6.539-6.537 10.222-15.336 10.222-24.709zM15.369 145.139c-2.212-3.59-3.369-7.688-3.369-11.997 0-12.682 10.317-23 23-23 5.444 0 10.558 1.851 14.649 5.258-14.622 8.302-26.132 18.289-34.28 29.739zm52.671 20.266c0-13.785 11.215-25 25-25s25 11.215 25 25-11.215 25-25 25-25-11.215-25-25zm123.119 57.054c-9.745 10.637-29.396 17.244-51.285 17.244-21.888 0-41.539-6.607-51.284-17.244a9.937 9.937 0 0 1-2.617-7.192 9.933 9.933 0 0 1 3.235-6.937 9.974 9.974 0 0 1 6.754-2.627c2.797 0 5.484 1.183 7.373 3.244 5.803 6.333 20.827 10.756 36.539 10.756s30.737-4.423 36.539-10.756a10.022 10.022 0 0 1 7.374-3.244c2.508 0 4.906.933 6.755 2.627a9.928 9.928 0 0 1 3.234 6.937 9.933 9.933 0 0 1-2.617 7.192zm-4.451-32.054c-13.785 0-25-11.215-25-25s11.215-25 25-25 25 11.215 25 25-11.215 25-25 25zm77.671-45.266c-8.147-11.45-19.657-21.436-34.28-29.739 4.092-3.408 9.205-5.258 14.649-5.258 12.683 0 23 10.318 23 23 0 4.309-1.157 8.407-3.369 11.997z"/></svg></a></li>
            <li><a href="https://groups.google.com/forum/#!forum/tidb-user" class="google-plus" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.858 491.858" width="18" height="18"><path d="M377.472 224.957H201.319v58.718H308.79c-16.032 51.048-63.714 88.077-120.055 88.077-69.492 0-125.823-56.335-125.823-125.824 0-69.492 56.333-125.823 125.823-125.823 34.994 0 66.645 14.289 89.452 37.346l42.622-46.328c-34.04-33.355-80.65-53.929-132.074-53.929C84.5 57.193 0 141.693 0 245.928s84.5 188.737 188.736 188.737c91.307 0 171.248-64.844 188.737-150.989v-58.718l-.001-.001zM491.858 224.857h-36.031v-36.031h-30.886v36.031H388.91v30.883h36.031v36.032h30.886V255.74h36.031z"/></svg></a></li>
            <li><a href="https://stackoverflow.com/questions/tagged/tidb" class="stack-overflow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 547.597 547.597"><path d="M140.81 475.111h.024l189.91-.269c8.434-.013 15.3-6.886 15.3-15.318v-21.298c0-8.428-6.854-15.288-15.3-15.288l-189.91.264c-8.433.012-15.3 6.885-15.3 15.318v21.31c.001 8.427 6.855 15.281 15.276 15.281z"/><path d="M58.667 517.854c.073 29.26.073 29.449 3.072 29.449h.055l10.612.294h.086s85.814 0 171.629-.036c42.914-.019 85.821-.05 118-.092 16.09-.019 29.505-.043 38.887-.074 17.803-.055 17.803-.055 17.803-3.072l.3-10.697V333.299c0-8.434-6.866-15.3-15.3-15.3h-11.909c-8.434 0-15.3 6.866-15.3 15.3V496.22c0 5.062-4.119 9.18-9.181 9.18H110.51c-5.061 0-9.18-4.118-9.18-9.18V333.299c0-8.434-6.867-15.3-15.3-15.3H73.82c-8.433 0-15.3 6.86-15.3 15.3 0 23.342.012 76.084.055 122.981.019 23.447.05 45.442.092 61.574z"/><path d="M142.322 397.399l189.402 17.467c.478.043.948.062 1.413.062 7.956 0 14.468-5.985 15.159-13.917l1.83-21.096c.729-8.396-5.508-15.851-13.898-16.628l-189.102-17.461c-8.593-.795-15.869 5.441-16.653 13.825l-1.97 21.108a15.172 15.172 0 0 0 3.452 11.181 15.19 15.19 0 0 0 10.367 5.459zM437.636 208.849a15.253 15.253 0 0 0 17.694 12.443l21.065-3.678c8.311-1.451 13.898-9.395 12.454-17.706l-32.504-187.23c-1.42-8.207-9.21-13.917-17.692-12.448l-21.065 3.678c-8.311 1.451-13.898 9.395-12.454 17.705l32.502 187.236zM190.333 194.375l163.6 96.708a15.28 15.28 0 0 0 7.778 2.136c5.393 0 10.447-2.876 13.183-7.509l10.876-18.36c2.08-3.519 2.674-7.631 1.658-11.591a15.18 15.18 0 0 0-7.032-9.358l-163.6-96.714c-7.014-4.149-16.836-1.597-20.967 5.374l-10.869 18.36a15.2 15.2 0 0 0-1.658 11.591 15.21 15.21 0 0 0 7.031 9.363zM387.525 240.501a15.276 15.276 0 0 0 12.626 6.659c3.091 0 6.077-.924 8.635-2.681l17.405-11.934c6.953-4.768 8.752-14.314 4.015-21.292L323.29 54.104c-4.584-6.732-14.498-8.623-21.236-3.984l-17.737 12.21c-6.945 4.779-8.727 14.327-3.971 21.291l107.179 156.88zM154.482 302.319l183.465 49.156c1.298.349 2.632.526 3.966.526 6.903 0 12.98-4.67 14.762-11.347l5.508-20.624c2.179-8.152-2.681-16.555-10.826-18.74l-183.465-49.162c-8.017-2.148-16.604 2.852-18.728 10.826l-5.508 20.63c-2.179 8.142 2.68 16.551 10.826 18.735z"/></svg></a></li>
            </ul>
        </div>
        <div class="subscribe">
            <a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm"><button class="btn btn-subscribe f-tc" style="margin-left: 0.75rem;">Subscribe to Blog</button></a>
        </div>
        </div>
        <div class="container">
        <a href="/blog-cn" class="btn-lang" id="lang">中文</a>
        </div>
    </div>
</nav>

<div class="blog">
        <div class="blogArticle__container">
            
            <div class="archive"><div class="article-nav">
                            <a href="/blog/#Engineering">BLOG HOME</a> <span> > </span>Engineering</div><div class="content markdown-body">
                    <h1 class="title">TiDB Operator Source Code Reading (V): Backup and Restore</h1>
                    <ul class="blog-post-meta">
                        <li class="meta-item">
                            <img src="/images/svgs/icon-date.svg" alt="Date icon">Tue, Dec 14, 2021</li>
                        <li class="meta-item">
                            <img src="/images/svgs/icon-writer.svg" alt="Pen icon">Elon Li</li>
                    </ul>
                    <div class="blog-text"><p><strong>Author:</strong> <a href="https://github.com/dragonly">Elon Li</a> (Software Engineer at PingCAP)</p>
<p><strong>Transcreator:</strong> <a href="https://github.com/ran-huang">Ran Huang</a>; <strong>Editor:</strong> Tom Dewan</p>
<p><img src="media/tidb-operator-source-code-reading-v-backup-and-restore.jpg" alt="Kubernetes cloud-native TiDB"></p>
<p><em>Previous articles in this series:</em></p>
<ul>
<li><em><a href="https://pingcap.com/blog/tidb-operator-source-code-reading-1-overview">TiDB Operator Source Code Reading (I): Overview</a></em></li>
<li><em><a href="https://pingcap.com/blog/tidb-operator-source-code-reading-2-operator-pattern">TiDB Operator Source Code Reading (II): Operator Pattern</a></em></li>
<li><em><a href="https://pingcap.com/blog/tidb-operator-source-code-reading-3-component-control-loop">TiDB Operator Source Code Reading (III): The Component Control Loop</a></em></li>
<li><em><a href="https://pingcap.com/blog/tidb-operator-source-code-reading-4-implement-component-control-loop">TiDB Operator Source Code Reading (IV): Implementing a Component Control Loop</a></em></li>
</ul>
<p>In our last article, we learned how to <a href="https://pingcap.com/blog/tidb-operator-source-code-reading-4-implement-component-control-loop">implement a component control loop</a> in TiDB Operator. This time, I'll move on to a new but important topic: backup and restore.</p>
<p>Backup and restore are two of the most important and frequently used operations when you maintain a database. To ensure data safety, database maintainers usually need a set of scripts that automatically back up the data and recover the dataset when data is corrupted. A well-designed backup and restore platform should allow you to:</p>
<ul>
<li>Choose different data sources and target storage.</li>
<li>Execute backup jobs on scheduled time.</li>
<li>Maintain the backup and restore history for auditing.</li>
<li>Clean up obsolete backup files to save storage space.</li>
</ul>
<p>TiDB Operator provides CustomResourceDefinitions (CRDs) for all these requirements. In this post, <strong>I'll walk you through the core design logic of TiDB Operator's backup and restore features</strong>, leaving out the trivial implementation details. Let's get started.</p>
<h2 id="controllers">Controllers</h2>
<p>TiDB Operator performs ad-hoc backup, restore, and scheduled backup via custom resources (CRs) such as <code>Backup</code>, <code>Restore</code>, and <code>BackupSchedule</code>, so we implement three corresponding controllers to execute the control loops.</p>
<p>When a user needs to start a backup job, they can create a YAML file as follows and submit it to Kubernetes. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># An example backup job
apiVersion: pingcap.com/v1alpha1
kind: Backup
metadata:
  name: demo-backup-gcp
  namespace: test1
spec:
  br:
    cluster: mycluster
  gcs:
    projectId: gcp
    location: us-west2
    bucket: backup
    prefix: test1-demo1
    secretName: gcp-secret
</code></pre></div><p>When the backup controller receives an event that creates the <code>Backup</code> resource, it creates a job to do the configured backup operation. In the case above, it backs up data in the <code>mycluster</code> database in the <code>test1</code> namespace and stores the data in the GCP storage specified in the <code>gcs</code> field.</p>
<p>In the following sections, I'll explain the internal logic of the three controllers.</p>
<h3 id="the-backup-controller">The backup controller</h3>
<p>The backup controller manages the <code>Backup</code> CR. Based on the configuration in the <code>spec</code> field, the controller uses <a href="https://docs.pingcap.com/tidb/stable/backup-and-restore-tool">BR</a> or <a href="https://docs.pingcap.com/tidb/stable/dumpling-overview">Dumpling</a> to perform the backup task and deletes the corresponding backup file when the user deletes the <code>Backup</code> CR.</p>
<p>Similar to that of other controllers, <strong>the core of the backup controller is a control loop</strong>, which listens to the <code>Backup</code> CR events (create, update, and delete) and runs the required operations.</p>
<p>In this section, I'll skip the generic control loop logic and focus on the core backup logic.</p>
<h4 id="core-logic">Core logic</h4>
<p>The core logic of the backup controller is implemented in the <code>syncBackupJob</code> function in the <code>pkg/backup/backup/backup_manager.go</code> file. The actual code processes many corner cases; to facilitate understanding, we removed the unimportant details, so you may see some function signatures are inconsistent. The core logic code is as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">backuputil.ValidateBackup(backup)
if err := JobLister.Jobs(ns).Get(backupJobName); err == nil {
    return nil
} else if !errors.IsNotFound(err) {
    return err
}
if backup.Spec.BR == nil {
    // create Job Spec which will use Dumpling to do the work
    job = bm.makeExportJob(backup)
} else {
    // create Job Spec which will use BR to do the work
    job = bm.makeBackupJob(backup)
}
if err := bm.deps.JobControl.CreateJob(backup, job); err != nil {
    // update Backup.Status with error message
}
</code></pre></div><p>In the code block above, <code>backup</code> is the Go struct converted from the <code>Backup</code> YAML created by the user. We use a <code>ValidateBackup</code> function to check the validity of the fields in <code>backup</code>.</p>
<p>Because the backup task is executed as a Kubernetes-native job and because the controller must ensure idempotency—duplicated executions don't affect the end result—it is possible that a job already exists. Therefore, we try to find if there is an existing backup job in the same namespace:</p>
<ul>
<li>If a job is found, the <code>if</code> statement returns <code>nil</code> and stops processing the current backup object.</li>
<li>If a job is not found, the controller proceeds to the next step.</li>
</ul>
<p>Next, the controller decides whether to use BR or Dumpling to perform the backup task and executes the corresponding function to create the Job spec. In this step, if you have configured the <code>br</code> field, the controller chooses BR; otherwise, it goes with Dumpling.</p>
<p>Finally, the controller uses <code>CreateJob</code> to create the job object and executes the backup operation in the job Pod.</p>
<h4 id="create-job">Create Job</h4>
<p>The actual backup job is created by two functions: <code>makeExportJob</code> and <code>makeBackupJob</code>. I'll take <code>makeBackupJob</code> as an example and explain its core code (which is simplified below):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">tc := bm.deps.TiDBClusterLister.TidbClusters(backupNamespace).Get(backup.Spec.BR.Cluster)
envVars := backuputil.GenerateTidbPasswordEnv(ns, name, backup, bm)
envVars = append(envVars, backuputil.GenerateStorageCertEnv(ns, backup, bm))
args := []string{&#34;backup&#34;, fmt.Sprintf(&#34;--namespace=%s&#34;, ns), fmt.Sprintf(&#34;--backupName=%s&#34;, name)}
podSpec := &amp;corev1.PodTemplateSpec{
    Spec: corev1.PodSpec{
        InitContainers: []corev1.Container{{
            Image:   &#34;pingcap/br&#34;,
            Command: []string{&#34;/bin/sh&#34;, &#34;-c&#34;},
            Args:    []string{fmt.Sprintf(&#34;cp /br %s/br; echo &#39;BR copy finished&#39;&#34;, util.BRBinPath)},
        }},
        Containers: []corev1.Container{{
            Image:           &#34;pingcap/tidb-backup-manager&#34;,
            Args:            args,
            Env:             util.AppendEnvIfPresent(envVars, &#34;TZ&#34;),
        }},
        Volumes:          volumes,
    },
}
job := &amp;batchv1.Job{
    Spec: batchv1.JobSpec{
        Template:     *podSpec,
    },
}
</code></pre></div><p>In the code above, the controller:</p>
<ol>
<li>Obtains the <code>TidbCluster</code> resources according to the backup information.</li>
<li>Sets the environment variables and command-line arguments.</li>
<li>Constructs a job using <code>pingcap/tidb-backup-manager</code> as the image to perform the backup task. In this process, the <code>pingcap/br</code> image is used as the init container so that BR is copied to the actual working container.</li>
<li>Executes the <a href="#heading=h.g8pxm2t1s6sp">backup-manager</a> logic after the job is created.</li>
</ol>
<p>The <code>makeExportJob</code> function takes similar steps, except that it uses Dumpling rather than BR.</p>
<div class="trackable-btns">
  <a href="/download" onclick="trackViews('TiDB Operator Source Code Reading (V): Backup and Restore', 'download-tidb-btn-middle')"><button>Download TiDB</button></a>
  <a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm" onclick="trackViews('TiDB Operator Source Code Reading (V): Backup and Restore', 'subscribe-blog-btn-middle')"><button>Subscribe to Blog</button></a>
</div>
<h4 id="clean-backup-files">Clean backup files</h4>
<p>After a user deletes the <code>Backup</code> resource, the backup controller deletes the backup files and releases the storage space.</p>
<p>As mentioned in the previous section, the backup controller creates a job when it receives the create event. Meanwhile, the controller adds a string (<code>tidb.pingcap.com/backup-protection</code>) to <code>finalizers</code> of the <code>Backup</code> resource, which signals that the resource needs special treatment when deleted. When a user deletes the <code>Backup</code> resource, the API server sets a value for the <code>metadata.deletionTimestamp</code> field. The backup controller then checks the clean policy of the <code>Backup</code> resource. If the clean policy isn't <code>Retain</code>, the controller creates a clean job to delete the backup files and reclaim the storage space.</p>
<h3 id="the-restore-controller">The restore controller</h3>
<p>Restoration is the reverse process of backup, and their core logic is similar.</p>
<p>The restore controller checks the validity of the <code>Restore</code> field and then calls the <code>makeImportJob</code> function (using TiDB Lightning) or the <code>makeRestoreJob</code> function (using BR) to create the restore job. The restore job also uses the backup-manager as a basic image.</p>
<h3 id="the-backupschedule-controller">The backupschedule controller</h3>
<p>To ensure data safety, we usually need to automatically back up important data on a scheduled basis. The backupschedule controller implements such functionality.</p>
<p>A user can schedule a backup job in Cron format and configure backup details similar to ad-hoc backup. After the configuration is submitted to the API server, TiDB Operator runs a scheduled backup with this configuration.</p>
<p>To avoid taking up a lot of storage, a user can also decide on the maximum number of copies to save or the maximum time to keep them. TiDB Operator deletes the outdated backup files.</p>
<p>The design logic of the backupschedule controller uses the existing functionality of the backup controller and encapsulates an abstraction layer for scheduled execution. When TiDB Operator runs a scheduled backup task, the backupschedule controller simply creates a <code>Backup</code> resource and has the backup controller do the rest.</p>
<p>You may have noticed that this design is similar to the relationship between <a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/">CronJob</a> and <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">the Job controller</a>. In fact, the implementation of the backupschedule controller is borrowed from CronJob, especially the logic that determines the next execution time.</p>
<h4 id="core-logic-1">Core logic</h4>
<p>The core logic of the backupschedule controller is implemented in the <code>Sync</code> function in the <code>pkg/backup/backupschedule/backup_schedule_manager.go</code> file. The main logic is as follows. For implementation details, you can refer to the source code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">func (bm *backupScheduleManager) Sync(bs *v1alpha1.BackupSchedule) error {
    defer bm.backupGC(bs)
    if err := bm.canPerformNextBackup(bs); err != nil { 
        return err 
    }    
    scheduledTime, err := getLastScheduledTime(bs, bm.now)
    if err := bm.deleteLastBackupJob(bs); err != nil { 
        return nil 
    }
    backup, err := createBackup(bm.deps.BackupControl, bs, *scheduledTime)
    bs.Status.LastBackup = backup.GetName()
    bs.Status.LastBackupTime = &amp;metav1.Time{Time: *scheduledTime}
    bs.Status.AllBackupCleanTime = nil
    return nil
}
</code></pre></div><p>The code first calls the <code>canPerformNextBackup</code> function to determine if a new <code>Backup</code> resource should be created to perform a new backup task. If the previous backup has completed or the previous backup has failed, the function agrees to execute the next backup; otherwise, the request is rejected.</p>
<p>After deciding to execute the backup task, the controller call <code>getLastScheduledTime</code> to get the next backup execution time. <code>getLastScheduledTime</code> calculates the last Cron time just before the current time, based on the current time and the Cron settings. <code>getLastScheduledTime</code> also handles a lot of boundary conditions; you can check the source code if you're interested to know more.</p>
<p>When the controller gets the backup time, it calls the <code>createBackup</code> function to create the <code>Backup</code> resource, thus leaving the actual backup operation to the backup controller.</p>
<h2 id="backup-manager">backup-manager</h2>
<p>To adapt TiDB Operator to the Kubernetes execution environment, we abstracted a backup-manager on top of BR, Dumpling, and TiDB Lightning. The backup-manager provides a uniform encapsulation of entry parameters for the tools. When each controller creates a job resource, it uses the backup-manager as an image. The backup-manager starts the corresponding tools to perform backup or restore tasks with the container start parameters and the <code>Backup</code>/<code>Restore</code> resource specs. Moreover, the backup-manager syncs the status of the <code>Backup</code> and <code>Restore</code> resources and updates their progress.</p>
<h3 id="backuprestore-using-br">Backup/restore using BR</h3>
<p>This section explains how the backup-manager implements the main logic of backup and restore. When the backup controller calls the <code>makeBackupJob</code> function to create a backup job, the Job controller starts a Pod to run the task, using the backup-manager as the image. The first container start parameter passed to <code>makeBackupJob</code> is <code>backup</code>; the <code>backup</code> processing logic is located in <strong><code>cmd/backup-manager/app/cmd/backup.go</code></strong>.</p>
<p>Similar to controllers, when the Pod is started, the backup-manager constructs a series of common Kubernetes client objects, such as Informer, Lister, and Updater. Then it calls the <code>ProcessBackup</code> function and performs the backup. The simplified main logic is as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">    backup, err := bm.backupLister.Backups(bm.Namespace).Get(bm.ResourceName)
    if backup.Spec.From == nil {
        return bm.performBackup(ctx, backup.DeepCopy(), nil)
    }
func (bm *Manager) performBackup(ctx context.Context, backup *v1alpha1.Backup, db *sql.DB) error {
    // update status to BackupRunning
    backupFullPath, err := util.GetStoragePath(backup)
    backupErr := bm.backupData(ctx, backup)
    // update status to BackupComplete
}
func (bo *Options) backupData(ctx context.Context, backup *v1alpha1.Backup) error {
    clusterNamespace := backup.Spec.BR.ClusterNamespace
    args := make([]string, 0)
    args = append(args, fmt.Sprintf(&#34;--pd=%s-pd.%s:2379&#34;, backup.Spec.BR.Cluster, clusterNamespace))
    dataArgs, err := constructOptions(backup)
    args = append(args, dataArgs...)
    fullArgs := []string{&#34;backup&#34;, backupType}
    fullArgs = append(fullArgs, args...)
    klog.Infof(&#34;Running br command with args: %v&#34;, fullArgs)
    bin := path.Join(util.BRBinPath, &#34;br&#34;)
    cmd := exec.CommandContext(ctx, bin, fullArgs...)
    // parse error messages
}
</code></pre></div><p><code>ProcessBackup</code> runs on a simple logic:</p>
<ol>
<li>It obtains the <code>Backup</code> object in the corresponding namespace and calls <code>performBackup</code>.</li>
<li>The <code>performBackup</code> function gets the backup storage path and calls the <code>backupData</code> function. We support three backup paths: <code>s3</code>, <code>gcs</code>, and <code>local</code>. <code>local</code> refers to the local path mounted by persistent volumes (PVs).</li>
<li><code>backupData</code> uses BR to perform the backup. This function combines the command-line parameters BR needs and uses <code>backup</code> as the command to run the BR binary and parse error messages.</li>
</ol>
<p>After the <code>backup</code> command runs successfully, the backup task is complete.</p>
<h3 id="importexport-using-dumpling-and-tidb-lightning">Import/export using Dumpling and TiDB Lightning</h3>
<p>Import and export are similar to backup and restore using BR, except that the tools involved are Dumpling and TiDB Lightning. You can check the previous section for details.</p>
<h3 id="clean">Clean</h3>
<p>When the backup controller creates a job to execute the <strong>clean</strong> command, the backup-manager executes the clean logic to delete the corresponding backup files. In <code>cmd/backup-manager/app/cmd/clean.go</code>, the clean logic calls the <code>ProcessCleanBackup</code> function to start the clean process.</p>
<p>After a series of checks, the controller calls <code>cleanBRRemoteBackupData</code> or <code>cleanRemoteBackupData</code> to delete the BR or Dumpling backup files from remote storage.</p>
<h2 id="summary">Summary</h2>
<p>In this post, we talked about the design and implementation of TiDB Operator's backup and restore features. When a user creates a backup or restore task, the corresponding backup, restore, or backupschedule controller calls the backup-manager to run the actual operations. The backupschedule controller encapsulates the timing task logic based on the backup controller, while the backup-manager encapsulates the specific tools into a unified portal for each controller to call.</p>
<p>If you are interested in learning more about TiDB Operator, feel free to <a href="https://slack.tidb.io/invite?team=tidb-community&amp;channel=sig-k8s&amp;ref=pingcap-blog">join our Slack channel</a> or join our discussions at <a href="https://github.com/pingcap/tidb-operator">pingcap/tidb-operator</a>.</p>
</div>
                </div>
                <div class="article-toc"></div><div class="ssba-wrap">
    <div class="ssba">
        <a data-site="" class="ssba_twitter_share" href="http://twitter.com/share?url=https%3a%2f%2fidiks.com%2fblog%2ftidb-operator-source-code-reading-v-backup-and-restore%2f" target="_blank">
        
            <img src="/images/svgs/twitter-icon.svg" alt="Twitter icon" />
        </a>
        <a data-site="reddit" class="ssba_reddit_share" href="http://reddit.com/submit?url=https%3a%2f%2fidiks.com%2fblog%2ftidb-operator-source-code-reading-v-backup-and-restore%2f&title=TiDB%20Operator%20Source%20Code%20Reading%20%28V%29%3a%20Backup%20and%20Restore" target="_blank">
        
            <img src="/images/svgs/reddit-icon.svg" alt="Reddit icon" />
        </a>
        <a data-site="" class="ssba_facebook_share" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fidiks.com%2fblog%2ftidb-operator-source-code-reading-v-backup-and-restore%2f" target="_blank">
        
            <img src="/images/svgs/facebook-icon.svg" alt="Fackbook icon" />
        </a>
        <a data-site="linkedin" class="ssba_linkedin_share" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fidiks.com%2fblog%2ftidb-operator-source-code-reading-v-backup-and-restore%2f" target="_blank">
        
            <img src="/images/svgs/linkedin-icon.svg" alt="Linkedin icon" />
        </a>
        <a data-site="hackernews" class="ssba_hackernews_share" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fidiks.com%2fblog%2ftidb-operator-source-code-reading-v-backup-and-restore%2f&t=TiDB%20Operator%20Source%20Code%20Reading%20%28V%29%3a%20Backup%20and%20Restore" target="_blank">
        
            <img src="/images/svgs/hacker-news-icon.svg" alt="Hacker News icon" />
        </a>
    </div>
</div>
<div class="trackable-btns">
                    <a href="/download" onclick="trackViews('TiDB Operator Source Code Reading (V): Backup and Restore', 'download-tidb-btn-bottom')"><button>Download
                        TiDB</button></a>
                    <a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm"
                      onclick="trackViews('TiDB Operator Source Code Reading (V): Backup and Restore', 'subscribe-blog-btn-bottom')"><button>Subscribe to
                        Blog</button></a>
                </div>
            </div>
            <div class="sidebar-page">
                <div class="sticky-sidebar">
                    <p class="toc-title">What’s on this page</p>
                    <div id="smart_toc_wrapper"></div>
                </div>
            </div>
        </div>
    </div>
<footer>
    <div class="container">
        <div class="flex-list-wrap">
            <div class="flex-list">
                <h4 class="list-title"><strong>Product</strong></h4>
                <ul>
                <li><a href="/docs/v3.0/">TiDB</a></li>
                <li><a href="/docs/v3.0/reference/tispark/">TiSpark</a></li>
                <li><a href="/docs/v3.0/roadmap/">Roadmap</a></li>
                </ul>
            </div>
            <div class="flex-list">
                <h4 class="list-title"><strong>Docs</strong></h4>
                <ul>
                <li><a href="/docs/stable/quick-start-with-tidb/">Quick Start</a></li>
                <li><a href="/blog/2017-07-24-tidbbestpractice/">Best Practices</a></li>
                <li><a href="/docs/stable/faq/tidb/">FAQ</a></li>
                <li><a href="/docs/stable/reference/tools/user-guide/">TiDB Tools</a></li>
                <li><a href="/docs/dev/releases/rn/">Release Notes</a></li>
                </ul>
            </div>
            <div class="flex-list">
                <h4 class="list-title"><strong>Resources</strong></h4>
                <ul>
                <li><a href="/blog/">Blog</a></li>
                <li><a href="/weekly/">Monthly</a></li>
                <li><a href="https://github.com/idiks" target="_blank">GitHub</a></li>
                <li><a href="/community">TiDB Community</a></li>
                </ul>
            </div>
            <div class="flex-list">
                <h4 class="list-title"><strong>Company</strong></h4>
                <ul>
                <li><a href="/about/">About</a></li>
                <li><a href="/jobs" target="_blank">Careers</a></li>
                <li><a href="/news/">News</a></li>
                <li><a href="/contact-us/">Contact Us</a></li>
                <li><a href="/privacy-policy/">Privacy Policy</a></li>
                <li><a href="/terms-of-service/">Terms of Service</a></li>
                </ul>
            </div>
        </div>
        <div class="contact-list-wrap">
            <div class="flex-list">
                <h4 class="list-title"><strong>Connect</strong></h4>
                <ul>
                <li><a href="https://twitter.com/idiks" class="twitter" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" width="18" height="19"><path d="M612 116.258a250.714 250.714 0 0 1-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 0 1-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"/></svg> Twitter</a></li>
                <li><a href="https://www.linkedin.com/company/idiks/" class="linkedin" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 438.536 438.535"><path d="M5.424 145.895H99.64v282.932H5.424zM408.842 171.739c-19.791-21.604-45.967-32.408-78.512-32.408-11.991 0-22.891 1.475-32.695 4.427-9.801 2.95-18.079 7.089-24.838 12.419-6.755 5.33-12.135 10.278-16.129 14.844-3.798 4.337-7.512 9.389-11.136 15.104v-40.232h-93.935l.288 13.706c.193 9.139.288 37.307.288 84.508 0 47.205-.19 108.777-.572 184.722h93.931V270.942c0-9.705 1.041-17.412 3.139-23.127 4-9.712 10.037-17.843 18.131-24.407 8.093-6.572 18.13-9.855 30.125-9.855 16.364 0 28.407 5.662 36.117 16.987 7.707 11.324 11.561 26.98 11.561 46.966V428.82h93.931V266.664c-.007-41.688-9.897-73.328-29.694-94.925zM53.103 9.708c-15.796 0-28.595 4.619-38.4 13.848C4.899 32.787 0 44.441 0 58.529 0 72.42 4.758 84.034 14.275 93.358c9.514 9.325 22.078 13.99 37.685 13.99h.571c15.99 0 28.887-4.661 38.688-13.99 9.801-9.324 14.606-20.934 14.417-34.829-.19-14.087-5.047-25.742-14.561-34.973C81.562 14.323 68.9 9.708 53.103 9.708z"/></svg> LinkedIn</a></li>
                <li><a href="https://www.reddit.com/r/idiks/" class="reddit" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 279.748 279.748" width="18" height="18"><path d="M279.748 133.142c0-19.299-15.701-35-35-35-10.768 0-20.674 4.812-27.279 13.064-18.532-8.431-39.663-13.626-62.015-15.271l19.206-60.692 42.895 9.294c3.285 12.782 14.901 22.258 28.693 22.258 16.336 0 29.627-13.29 29.627-29.626 0-16.336-13.291-29.627-29.627-29.627-11.801 0-21.999 6.941-26.759 16.95l-49.497-10.725a10.002 10.002 0 0 0-11.651 6.756L134.636 95.43c-26.164.638-50.988 6.053-72.356 15.775-6.606-8.251-16.512-13.063-27.28-13.063-19.299 0-35 15.701-35 35 0 9.373 3.683 18.173 10.222 24.709-3.9 8.37-5.875 17.076-5.875 25.936 0 24.048 14.396 46.492 40.538 63.199 25.447 16.264 59.183 25.221 94.989 25.221 35.808 0 69.542-8.957 94.989-25.221 26.142-16.707 40.538-39.151 40.538-63.199 0-8.859-1.975-17.565-5.875-25.936 6.539-6.537 10.222-15.336 10.222-24.709zM15.369 145.139c-2.212-3.59-3.369-7.688-3.369-11.997 0-12.682 10.317-23 23-23 5.444 0 10.558 1.851 14.649 5.258-14.622 8.302-26.132 18.289-34.28 29.739zm52.671 20.266c0-13.785 11.215-25 25-25s25 11.215 25 25-11.215 25-25 25-25-11.215-25-25zm123.119 57.054c-9.745 10.637-29.396 17.244-51.285 17.244-21.888 0-41.539-6.607-51.284-17.244a9.937 9.937 0 0 1-2.617-7.192 9.933 9.933 0 0 1 3.235-6.937 9.974 9.974 0 0 1 6.754-2.627c2.797 0 5.484 1.183 7.373 3.244 5.803 6.333 20.827 10.756 36.539 10.756s30.737-4.423 36.539-10.756a10.022 10.022 0 0 1 7.374-3.244c2.508 0 4.906.933 6.755 2.627a9.928 9.928 0 0 1 3.234 6.937 9.933 9.933 0 0 1-2.617 7.192zm-4.451-32.054c-13.785 0-25-11.215-25-25s11.215-25 25-25 25 11.215 25 25-11.215 25-25 25zm77.671-45.266c-8.147-11.45-19.657-21.436-34.28-29.739 4.092-3.408 9.205-5.258 14.649-5.258 12.683 0 23 10.318 23 23 0 4.309-1.157 8.407-3.369 11.997z"/></svg>Reddit</a></li>
                <li><a href="https://groups.google.com/forum/#!forum/idiks-user" class="google-plus" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.858 491.858" width="18" height="20"><path d="M377.472 224.957H201.319v58.718H308.79c-16.032 51.048-63.714 88.077-120.055 88.077-69.492 0-125.823-56.335-125.823-125.824 0-69.492 56.333-125.823 125.823-125.823 34.994 0 66.645 14.289 89.452 37.346l42.622-46.328c-34.04-33.355-80.65-53.929-132.074-53.929C84.5 57.193 0 141.693 0 245.928s84.5 188.737 188.736 188.737c91.307 0 171.248-64.844 188.737-150.989v-58.718l-.001-.001zM491.858 224.857h-36.031v-36.031h-30.886v36.031H388.91v30.883h36.031v36.032h30.886V255.74h36.031z"/></svg>Google Group</a></li>
                <li><a href="https://stackoverflow.com/questions/tagged/idiks" class="stack-overflow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="17" viewBox="0 0 547.597 547.597"><path d="M140.81 475.111h.024l189.91-.269c8.434-.013 15.3-6.886 15.3-15.318v-21.298c0-8.428-6.854-15.288-15.3-15.288l-189.91.264c-8.433.012-15.3 6.885-15.3 15.318v21.31c.001 8.427 6.855 15.281 15.276 15.281z"/><path d="M58.667 517.854c.073 29.26.073 29.449 3.072 29.449h.055l10.612.294h.086s85.814 0 171.629-.036c42.914-.019 85.821-.05 118-.092 16.09-.019 29.505-.043 38.887-.074 17.803-.055 17.803-.055 17.803-3.072l.3-10.697V333.299c0-8.434-6.866-15.3-15.3-15.3h-11.909c-8.434 0-15.3 6.866-15.3 15.3V496.22c0 5.062-4.119 9.18-9.181 9.18H110.51c-5.061 0-9.18-4.118-9.18-9.18V333.299c0-8.434-6.867-15.3-15.3-15.3H73.82c-8.433 0-15.3 6.86-15.3 15.3 0 23.342.012 76.084.055 122.981.019 23.447.05 45.442.092 61.574z"/><path d="M142.322 397.399l189.402 17.467c.478.043.948.062 1.413.062 7.956 0 14.468-5.985 15.159-13.917l1.83-21.096c.729-8.396-5.508-15.851-13.898-16.628l-189.102-17.461c-8.593-.795-15.869 5.441-16.653 13.825l-1.97 21.108a15.172 15.172 0 0 0 3.452 11.181 15.19 15.19 0 0 0 10.367 5.459zM437.636 208.849a15.253 15.253 0 0 0 17.694 12.443l21.065-3.678c8.311-1.451 13.898-9.395 12.454-17.706l-32.504-187.23c-1.42-8.207-9.21-13.917-17.692-12.448l-21.065 3.678c-8.311 1.451-13.898 9.395-12.454 17.705l32.502 187.236zM190.333 194.375l163.6 96.708a15.28 15.28 0 0 0 7.778 2.136c5.393 0 10.447-2.876 13.183-7.509l10.876-18.36c2.08-3.519 2.674-7.631 1.658-11.591a15.18 15.18 0 0 0-7.032-9.358l-163.6-96.714c-7.014-4.149-16.836-1.597-20.967 5.374l-10.869 18.36a15.2 15.2 0 0 0-1.658 11.591 15.21 15.21 0 0 0 7.031 9.363zM387.525 240.501a15.276 15.276 0 0 0 12.626 6.659c3.091 0 6.077-.924 8.635-2.681l17.405-11.934c6.953-4.768 8.752-14.314 4.015-21.292L323.29 54.104c-4.584-6.732-14.498-8.623-21.236-3.984l-17.737 12.21c-6.945 4.779-8.727 14.327-3.971 21.291l107.179 156.88zM154.482 302.319l183.465 49.156c1.298.349 2.632.526 3.966.526 6.903 0 12.98-4.67 14.762-11.347l5.508-20.624c2.179-8.152-2.681-16.555-10.826-18.74l-183.465-49.162c-8.017-2.148-16.604 2.852-18.728 10.826l-5.508 20.63c-2.179 8.142 2.68 16.551 10.826 18.735z"/></svg>Stack Overflow</a></li>
                </ul>
            </div>
            <div class="subscribe">
                <a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm"><button class="btn btn-subscribe f-tc">Subscribe to Blog</button></a>
            </div>
        </div>
    </div>
    <div class="container copyright-container">
        <p class="copyright">&copy; 2025 iDIKS. All Rights Reserved.</p>
        <a href="/blog-cn" class="copyright-btn-lang" id="lang">中文</a>
    </div>
</footer>
<button class="back-to-top" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 284.929 284.929"><path d="M282.082 195.285L149.028 62.24c-1.901-1.903-4.088-2.856-6.562-2.856s-4.665.953-6.567 2.856L2.856 195.285C.95 197.191 0 199.378 0 201.853c0 2.474.953 4.664 2.856 6.566l14.272 14.271c1.903 1.903 4.093 2.854 6.567 2.854s4.664-.951 6.567-2.854l112.204-112.202 112.208 112.209c1.902 1.903 4.093 2.848 6.563 2.848 2.478 0 4.668-.951 6.57-2.848l14.274-14.277c1.902-1.902 2.847-4.093 2.847-6.566.001-2.476-.944-4.666-2.846-6.569z" fill="#FFF"/></svg>
</button>
</div><div class="overlay"></div><script src="https://static.idiks.com/js/jquery.min.js"></script><script type="text/javascript" src="/js/vendor/lazyload.min.js"></script>
    <script type="text/javascript" src="/js/doc.js"></script>
    <script type="text/javascript" src="/js/anchor.js"></script><script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script src="https://browser.sentry-cdn.com/5.11.0/bundle.min.js" integrity="sha384-jbFinqIbKkHNg+QL+yxB4VrBC0EAPTuaLGeRT0T+NfEV89YC6u1bKxHLwoo+/xxY" crossorigin="anonymous"></script><script>Sentry.init({ 
            dsn: 'https://3f28ed393c5545daa74496b3cdb2e9ba@sentry.io/1887163' 
        });</script><script src="/js/app.js"></script></body></html>