<!doctype html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<script>
window.ga =
    window.ga ||
    function() {
        ;(ga.q = ga.q || []).push(arguments)
    }
ga.l = +new Date()
ga('create', 'UA-99991864-4', 'auto')
ga('send', 'pageview')
</script>
<script async src="https://static.idiks.com/js/ga-analytics.js"></script>



<link rel="stylesheet" href="https://static.idiks.com/style/github-markdown.css">


<link rel="stylesheet" href="/css/doc.css">

    
    <title>Best Practices for TiDB Load Balancing |&nbsp;TiDB</title><link rel="icon" href="/images/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<meta name="description" content="Load balancing helps you distribute application connections over multiple servers and reroute connections if a TiDB instance becomes unavailable. This article talks about the best practices for TiDB load balancing.">
<meta name="robots" content="noodp">
<meta name="keywords" content="TiDB, MySQL, HTAP, Open Source, Cloud-Native, NewSQL, Aurora Alternative">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="website">
<meta property="og:title" content="Best Practices for TiDB Load Balancing | TiDB">
<meta property="og:description" content="Load balancing helps you distribute application connections over multiple servers and reroute connections if a TiDB instance becomes unavailable. This article talks about the best practices for TiDB load balancing.">
<meta property="og:url" content="https://idiks.com/blog/best-practices-for-tidb-load-balancing/">
<meta property="og:site_name" content="MySQL at Scale. No more manual sharding">
<meta property="og:image" content="/images/blog/best-practices-for-tidb-load-balancing.png">
<meta property="og:image:secure_url" content="/images/blog/best-practices-for-tidb-load-balancing.png"><meta name="twitter:card" content="summary_large_image">
<meta name="og:image:width" content="1200">
<meta name="og:image:height" content="600"><meta name="twitter:description" content="Load balancing helps you distribute application connections over multiple servers and reroute connections if a TiDB instance becomes unavailable. This article talks about the best practices for TiDB load balancing.">
<meta name="twitter:title" content="Best Practices for TiDB Load Balancing | TiDB">
<meta name="twitter:site" content="@pingcap">
<meta name="twitter:image" content="https://static.idiks.com/images/blog/best-practices-for-tidb-load-balancing.png"><meta name="twitter:creator" content="@pingcap">





<script type="application/ld+json">
{
    "@context": "http:\/\/schema.org",
    "@type": "WebSite",
    "url": "https:\/\/pingcap.com\/",
    "name": "PingCAP",
    "potentialAction": {
        "@type": "SearchAction",
        "target": "https:\/\/pingcap.com\/?s={search_term_string}",
        "query-input": "required name=search_term_string"
    }
}
</script>


<script>
    (function(){
        var bp = document.createElement('script');
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>


<script type="text/javascript" async src="https://accounts.pingcap.com/static/pingcap_sso/js/track.beta.js"></script>
    
<link rel="preload" href="https://static.idiks.com/fonts/lato/lato-regular-webfont.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/lato/lato-regular-webfont.woff" as="font" type="font/woff" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/lato/lato-regular-webfont.ttf" as="font" type="font/ttf" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/titilliumweb/titilliumweb-regular-webfont.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/titilliumweb/titilliumweb-regular-webfont.woff" as="font" type="font/woff" crossorigin="anonymous">
<link rel="preload" href="https://static.idiks.com/fonts/titilliumweb/titilliumweb-regular-webfont.ttf" as="font" type="font/ttf" crossorigin="anonymous">

<link rel="preload" href="https://static.idiks.com/js/jquery.min.js" as="script">


<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="https://static.idiks.com/style/docsearch.min.css">
<script type="text/javascript">
var trackOutboundLink = function(url) {
  var redirectTriggered = false
  ga('send', 'event', 'outbound', 'click', url, {
    hitCallback: function() {
      redirectTriggered = true
      document.location = url
    }
  })
  setTimeout(function() {
    if (!redirectTriggered) {
      document.location = url
    }
  }, 1500)
}

var trackViews = function(btn_type, event_category) {
  var event_label = btn_type
  var eventCategory = event_category
  ga('send', 'event', {
    'eventCategory': eventCategory,
    'eventAction': 'click',
    'eventLabel': event_label,
    'transport': 'beacon'
  });
}
</script>
<script>if (location.pathname === '/') {
        if (location.hostname === 'idiks.github.io') {
            location.href = '/en/'
        }
    }</script></head>       <body data-lang="en" ><div id="page-content">

<header role="navigation" class="fixed-top">
    <div class="container">
        <a class="nav-brand" href="/en"><img src="/images/pingcap-logo.png" alt="PingCAP"></a>
        <div class="nav-wrapper">
            <div class="navigation">
                <ul>
                <li ><a class="a-en" href="https://idiks.com">Cloud</a></li>
                <li ><a class="a-en" class="tidb-academy"
                    href="/tidb-academy">iDIKS Academy</a></li>
                <li class="docs-type-selector " id="docsTypeSelector">
                    <a class="header-doc-nav" href="#">Docs</a>
                    <div class="header-dropdown-menu" id="docsTypeSelectorItem">
                        <a class="header-dropdown-item" href="/docs/stable/">TiDB</a>
                        <a class="header-dropdown-item" href="/docs/tidb-in-kubernetes/stable/">TiDB in Kubernetes</a>
                        <a class="header-dropdown-item" href="/docs/tidb-data-migration/stable/">TiDB Data Migration (DM)</a>
                    </div>
                </li>
                
                <li ><a class="a-en" href="/success-stories">Success
                    Stories</a></li>
                <li class="sel" ><a class="a-en" href="/blog">Blog</a></li>
                <li ><a class="link-download link-download-en" href="/download">Free Download</a></li>
                </ul>
            </div>
            <div class="global-search">
                
                
                
                <div class="search-wrapper">
    <span class="icon-search"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#fff" viewBox="0 0 67.125 67.125"><path d="M23.902 0C11.01 0 .523 10.488.523 23.38c0 12.891 10.487 23.379 23.379 23.379a23.258 23.258 0 0 0 14.471-5.037l24.816 24.817c.391.391.902.586 1.414.586s1.023-.195 1.414-.586a2 2 0 0 0 0-2.828L41.293 38.985c3.721-4.142 5.989-9.613 5.989-15.605C47.282 10.488 36.794 0 23.902 0zM4.523 23.38C4.523 12.694 13.216 4 23.902 4c10.687 0 19.38 8.694 19.38 19.38 0 5.396-2.221 10.279-5.791 13.795a1.959 1.959 0 0 0-.488.349 2.003 2.003 0 0 0-.271.343C33.31 40.9 28.825 42.76 23.903 42.76c-10.686-.001-19.38-8.695-19.38-19.38z"/><path d="M24.075 8.591c-8.25 0-14.962 6.712-14.962 14.962a2 2 0 0 0 4 0c0-6.044 4.918-10.962 10.962-10.962a2 2 0 0 0 0-4z"/></svg></span>
    <input data-lang="en" data-type="" type="search" id="search-input" name="q"
        placeholder="Search TiDB Docs">
</div>

<script>
    const inputNode = document.getElementById("search-input")

    inputNode.addEventListener('keyup', ({key}) => {
        if (key === "Enter") {
            if ($('#search-input').data('lang') == 'cn') {
                lang = 'zh'
            }

            const query = $('#search-input').val()
            if (query) {
                url = "https://idiks.com/docs" + (lang == 'zh' ? 'zh/' : '') + "search/?lang=" + lang + "&type=tidb&version=v4.0&q=" + query
                window.location.href = url
            }
        }
    })
</script>

            </div>
        </div>
        <div class="nav-btn nav-slider">
            <i class="material-icons"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 459 459"><path d="M0 382.5h459v-51H0v51zM0 255h459v-51H0v51zM0 76.5v51h459v-51H0z" fill="#FFF"/></svg></i>
        </div>
    </div>
</header>



<nav class="mobile-sidebar">
    <div class="nav-header">
        <div class="logo-wrap">
        <a class="nav-brand" href="/en"><img src="/images/pingcap-logo.png" alt="PingCAP"></a>
        </div>
    </div>
    <ul class="ul-base">
        <li ><a href="https://idiks.com/">Cloud</a></li>
        <li ><a class="tidb-academy" href="/tidb-academy">TiDB Academy</a></li>
        <li class="docs-type-selector " id="docsTypeSelector">
            <p class="header-doc-nav">Docs</p>
            <div class="header-dropdown-menu" id="docsTypeSelectorItem">
                <a class="header-dropdown-item" href="/docs/stable/">TiDB</a>
                <a class="header-dropdown-item" href="/docs/tidb-in-kubernetes/stable/">TiDB in Kubernetes</a>
                <a class="header-dropdown-item" href="/docs/tidb-data-migration/stable/">TiDB Data Migration (DM)</a>
            </div>
        </li>
        <li ><a href="/success-stories">Success Stories</a></li>
        <li class="sel"><a href="/blog">Blog</a></li>
        <li><a class="link-download" href="/download">Free Download</a></li>
    </ul>
    <div class="nav-footer">
        <div class="contact-list-wrap">
        <div class="flex-list">
            <h4 class="list-title"><strong>Contact</strong></h4>
            <ul class="social ul-base">
            <li><a href="https://twitter.com/PingCAP" class="twitter" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" width="18" height="18"><path d="M612 116.258a250.714 250.714 0 0 1-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 0 1-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"/></svg></a></li>
            <li><a href="https://www.linkedin.com/company/pingcap/" class="linkedin" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 438.536 438.535"><path d="M5.424 145.895H99.64v282.932H5.424zM408.842 171.739c-19.791-21.604-45.967-32.408-78.512-32.408-11.991 0-22.891 1.475-32.695 4.427-9.801 2.95-18.079 7.089-24.838 12.419-6.755 5.33-12.135 10.278-16.129 14.844-3.798 4.337-7.512 9.389-11.136 15.104v-40.232h-93.935l.288 13.706c.193 9.139.288 37.307.288 84.508 0 47.205-.19 108.777-.572 184.722h93.931V270.942c0-9.705 1.041-17.412 3.139-23.127 4-9.712 10.037-17.843 18.131-24.407 8.093-6.572 18.13-9.855 30.125-9.855 16.364 0 28.407 5.662 36.117 16.987 7.707 11.324 11.561 26.98 11.561 46.966V428.82h93.931V266.664c-.007-41.688-9.897-73.328-29.694-94.925zM53.103 9.708c-15.796 0-28.595 4.619-38.4 13.848C4.899 32.787 0 44.441 0 58.529 0 72.42 4.758 84.034 14.275 93.358c9.514 9.325 22.078 13.99 37.685 13.99h.571c15.99 0 28.887-4.661 38.688-13.99 9.801-9.324 14.606-20.934 14.417-34.829-.19-14.087-5.047-25.742-14.561-34.973C81.562 14.323 68.9 9.708 53.103 9.708z"/></svg></a></li>
            <li><a href="https://www.reddit.com/r/TiDB/" class="reddit" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 279.748 279.748" width="18" height="18"><path d="M279.748 133.142c0-19.299-15.701-35-35-35-10.768 0-20.674 4.812-27.279 13.064-18.532-8.431-39.663-13.626-62.015-15.271l19.206-60.692 42.895 9.294c3.285 12.782 14.901 22.258 28.693 22.258 16.336 0 29.627-13.29 29.627-29.626 0-16.336-13.291-29.627-29.627-29.627-11.801 0-21.999 6.941-26.759 16.95l-49.497-10.725a10.002 10.002 0 0 0-11.651 6.756L134.636 95.43c-26.164.638-50.988 6.053-72.356 15.775-6.606-8.251-16.512-13.063-27.28-13.063-19.299 0-35 15.701-35 35 0 9.373 3.683 18.173 10.222 24.709-3.9 8.37-5.875 17.076-5.875 25.936 0 24.048 14.396 46.492 40.538 63.199 25.447 16.264 59.183 25.221 94.989 25.221 35.808 0 69.542-8.957 94.989-25.221 26.142-16.707 40.538-39.151 40.538-63.199 0-8.859-1.975-17.565-5.875-25.936 6.539-6.537 10.222-15.336 10.222-24.709zM15.369 145.139c-2.212-3.59-3.369-7.688-3.369-11.997 0-12.682 10.317-23 23-23 5.444 0 10.558 1.851 14.649 5.258-14.622 8.302-26.132 18.289-34.28 29.739zm52.671 20.266c0-13.785 11.215-25 25-25s25 11.215 25 25-11.215 25-25 25-25-11.215-25-25zm123.119 57.054c-9.745 10.637-29.396 17.244-51.285 17.244-21.888 0-41.539-6.607-51.284-17.244a9.937 9.937 0 0 1-2.617-7.192 9.933 9.933 0 0 1 3.235-6.937 9.974 9.974 0 0 1 6.754-2.627c2.797 0 5.484 1.183 7.373 3.244 5.803 6.333 20.827 10.756 36.539 10.756s30.737-4.423 36.539-10.756a10.022 10.022 0 0 1 7.374-3.244c2.508 0 4.906.933 6.755 2.627a9.928 9.928 0 0 1 3.234 6.937 9.933 9.933 0 0 1-2.617 7.192zm-4.451-32.054c-13.785 0-25-11.215-25-25s11.215-25 25-25 25 11.215 25 25-11.215 25-25 25zm77.671-45.266c-8.147-11.45-19.657-21.436-34.28-29.739 4.092-3.408 9.205-5.258 14.649-5.258 12.683 0 23 10.318 23 23 0 4.309-1.157 8.407-3.369 11.997z"/></svg></a></li>
            <li><a href="https://groups.google.com/forum/#!forum/tidb-user" class="google-plus" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.858 491.858" width="18" height="18"><path d="M377.472 224.957H201.319v58.718H308.79c-16.032 51.048-63.714 88.077-120.055 88.077-69.492 0-125.823-56.335-125.823-125.824 0-69.492 56.333-125.823 125.823-125.823 34.994 0 66.645 14.289 89.452 37.346l42.622-46.328c-34.04-33.355-80.65-53.929-132.074-53.929C84.5 57.193 0 141.693 0 245.928s84.5 188.737 188.736 188.737c91.307 0 171.248-64.844 188.737-150.989v-58.718l-.001-.001zM491.858 224.857h-36.031v-36.031h-30.886v36.031H388.91v30.883h36.031v36.032h30.886V255.74h36.031z"/></svg></a></li>
            <li><a href="https://stackoverflow.com/questions/tagged/tidb" class="stack-overflow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 547.597 547.597"><path d="M140.81 475.111h.024l189.91-.269c8.434-.013 15.3-6.886 15.3-15.318v-21.298c0-8.428-6.854-15.288-15.3-15.288l-189.91.264c-8.433.012-15.3 6.885-15.3 15.318v21.31c.001 8.427 6.855 15.281 15.276 15.281z"/><path d="M58.667 517.854c.073 29.26.073 29.449 3.072 29.449h.055l10.612.294h.086s85.814 0 171.629-.036c42.914-.019 85.821-.05 118-.092 16.09-.019 29.505-.043 38.887-.074 17.803-.055 17.803-.055 17.803-3.072l.3-10.697V333.299c0-8.434-6.866-15.3-15.3-15.3h-11.909c-8.434 0-15.3 6.866-15.3 15.3V496.22c0 5.062-4.119 9.18-9.181 9.18H110.51c-5.061 0-9.18-4.118-9.18-9.18V333.299c0-8.434-6.867-15.3-15.3-15.3H73.82c-8.433 0-15.3 6.86-15.3 15.3 0 23.342.012 76.084.055 122.981.019 23.447.05 45.442.092 61.574z"/><path d="M142.322 397.399l189.402 17.467c.478.043.948.062 1.413.062 7.956 0 14.468-5.985 15.159-13.917l1.83-21.096c.729-8.396-5.508-15.851-13.898-16.628l-189.102-17.461c-8.593-.795-15.869 5.441-16.653 13.825l-1.97 21.108a15.172 15.172 0 0 0 3.452 11.181 15.19 15.19 0 0 0 10.367 5.459zM437.636 208.849a15.253 15.253 0 0 0 17.694 12.443l21.065-3.678c8.311-1.451 13.898-9.395 12.454-17.706l-32.504-187.23c-1.42-8.207-9.21-13.917-17.692-12.448l-21.065 3.678c-8.311 1.451-13.898 9.395-12.454 17.705l32.502 187.236zM190.333 194.375l163.6 96.708a15.28 15.28 0 0 0 7.778 2.136c5.393 0 10.447-2.876 13.183-7.509l10.876-18.36c2.08-3.519 2.674-7.631 1.658-11.591a15.18 15.18 0 0 0-7.032-9.358l-163.6-96.714c-7.014-4.149-16.836-1.597-20.967 5.374l-10.869 18.36a15.2 15.2 0 0 0-1.658 11.591 15.21 15.21 0 0 0 7.031 9.363zM387.525 240.501a15.276 15.276 0 0 0 12.626 6.659c3.091 0 6.077-.924 8.635-2.681l17.405-11.934c6.953-4.768 8.752-14.314 4.015-21.292L323.29 54.104c-4.584-6.732-14.498-8.623-21.236-3.984l-17.737 12.21c-6.945 4.779-8.727 14.327-3.971 21.291l107.179 156.88zM154.482 302.319l183.465 49.156c1.298.349 2.632.526 3.966.526 6.903 0 12.98-4.67 14.762-11.347l5.508-20.624c2.179-8.152-2.681-16.555-10.826-18.74l-183.465-49.162c-8.017-2.148-16.604 2.852-18.728 10.826l-5.508 20.63c-2.179 8.142 2.68 16.551 10.826 18.735z"/></svg></a></li>
            </ul>
        </div>
        <div class="subscribe">
            <a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm"><button class="btn btn-subscribe f-tc" style="margin-left: 0.75rem;">Subscribe to Blog</button></a>
        </div>
        </div>
        <div class="container">
        <a href="/blog-cn" class="btn-lang" id="lang">中文</a>
        </div>
    </div>
</nav>

<div class="blog">
        <div class="blogArticle__container">
            
            <div class="archive"><div class="article-nav">
                            <a href="/blog/#Product">BLOG HOME</a> <span> > </span>Product</div><div class="content markdown-body">
                    <h1 class="title">Best Practices for TiDB Load Balancing</h1>
                    <ul class="blog-post-meta">
                        <li class="meta-item">
                            <img src="/images/svgs/icon-date.svg" alt="Date icon">Tue, Sep 28, 2021</li>
                        <li class="meta-item">
                            <img src="/images/svgs/icon-writer.svg" alt="Pen icon">Daniël van Eeden</li>
                    </ul>
                    <div class="blog-text"><p><strong>Author:</strong> Daniël van Eeden (Technical Support Engineer at PingCAP)</p>
<p><strong>Editors:</strong> <a href="https://github.com/ran-huang">Ran Huang</a>, Tom Dewan</p>
<p><img src="media/best-practices-for-tidb-load-balancing.png" alt="Best Practices for TiDB Load Balancing"></p>
<p>Load balancing distributes connections from applications to TiDB Server instances. This helps to distribute the load over multiple machines and, depending on the load balancing option, can automatically reroute connections if a TiDB instance becomes unavailable.</p>
<h2 id="load-balancing-types">Load balancing types</h2>
<p>There are many different ways to implement a load balancer. This section describes the most common types.</p>
<table>
  <tr>
   <td><strong>Load balancer type</strong>
   </td>
   <td><strong>Usage scenarios</strong>
   </td>
   <td><strong>Benefits</strong>
   </td>
   <td><strong>Drawbacks</strong>
   </td>
  </tr>
  <tr>
   <td>Connector-based, such as MySQL Connector/J and MySQL Connector/C++
   </td>
   <td>Load balancing a specific application
   </td>
   <td>No need for extra components
   </td>
   <td>Connector-specific implementation and behavior
   </td>
  </tr>
  <tr>
   <td>DNS (Round-robin or SRV)
   </td>
   <td>Simple load balancing that doesn't require application changes
   </td>
   <td>Reuses existing components and methods
   </td>
   <td>Doesn't automatically remove failed nodes from service
   </td>
  </tr>
  <tr>
   <td>Kubernetes load balancer (e.g., metallb or Amazon Elastic Load Balancing)
   </td>
   <td>Load balancing in the cloud
   </td>
   <td>Well-integrated with Kubernetes
   </td>
   <td>Requires Kubernetes
   </td>
  </tr>
  <tr>
   <td>Software-based load balancer
   </td>
   <td>A daemon that implements load balancing
   </td>
   <td>Flexible
   </td>
   <td>Often service-specific
   </td>
  </tr>
  <tr>
   <td>Hardware-based load balancer (e.g., F5)
   </td>
   <td>A hardware load balancer
   </td>
   <td>Can use hardware acceleration
   </td>
   <td>Expensive
   </td>
  </tr>
</table>
<p>The first type of load balancing that is available is <strong>connector-based load balancing</strong>. Many of the MySQL connectors like MySQL Connector/J and MySQL Connector/C++. The benefits of this approach are that there is no extra network hop, and the application has more information about which server it is connected to. The drawbacks are that there is no central administration, and, when you change the configuration, you have to change it on all your application hosts. Depending on the programming language you use, the load balancing might not be available or not offer more advanced options. Connector-based load balancing can work with most third-party applications because it is often configured in the connection string—for example, Java Database Connectivity (JDBC) URL.</p>
<p>You could also use <strong>DNS round-robin</strong>. However, this is not advisable because it doesn't prevent connections from going to an unavailable machine. This means that if not all servers are available, your application might have to retry connections more often. Some of the newer MySQL connectors support <a href="https://dev.mysql.com/doc/refman/8.0/en/connecting-using-dns-srv.html">DNS SRV</a>. This is somewhat similar to round-robin DNS but allows you to set priorities. The benefit of DNS SRV is that it is an industry standard, and this makes the client-side configuration easier.</p>
<p>If you are using Kubernetes, you probably want to use the <a href="https://docs.pingcap.com/tidb-in-kubernetes/stable/access-tidb#loadbalancer">LoadBalancer</a> service type that works with Amazon ELB and similar services from other cloud vendors. For on-premise Kubernetes, you can use something like <a href="https://metallb.universe.tf/">metallb</a>.</p>
<p>Even if you're not using Kubernetes to deploy on a cloud service, you can still use the load balancing service from your cloud provider.</p>
<p>Another common option is to use a <strong>software-based</strong> load balancer, such as ProxySQL, HAProxy, or MySQL Router.</p>
<p>The last type of load balancing uses <strong>hardware-based</strong> load balancers. These are physical machines where you plug in a network cable. These are often costly but also offer high throughput.</p>
<h2 id="general-load-balancing-requirements-for-tidb">General load balancing requirements for TiDB</h2>
<p>The requirements that TiDB puts on load balancers are in some ways different from what a typical MySQL setup requires.</p>
<p>Where load balancers might offer advanced features like read/write splitting for MySQL, TiDB doesn't need this. The load balancer does not have to inspect the MySQL protocol. A TCP-level load balancer works fine for TiDB.</p>
<p>The load balancer only needs access to the TiDB servers (by default on TCP port 4000) and doesn't need access to Placement Driver (PD) or TiKV servers. When you use the <a href="https://docs.pingcap.com/tidb/stable/tidb-monitoring-api#use-the-state-interface">status API</a> (TCP port 10080 by default), access to this port is also required.</p>
<p>We recommend that you use <code>http://&lt;ip_of_tidb&gt;:10080/status</code> as the health check because it supports the <em>graceful shutdown</em> feature. This feature allows you to drain client connections before you shut down a TiDB Server, and it reduces the impact on applications. To benefit from this feature, you must set the <a href="https://docs.pingcap.com/tidb/stable/tidb-configuration-file#graceful-wait-before-shutdown-new-in-v50"><code>graceful-wait-before-shutdown</code> variable</a> to a non-zero value.</p>
<p>You should avoid health checks that check for <code>read_only</code> or other MySQL or InnoDB-specific variables. These variables are often implemented as &ldquo;noop&rdquo; on TiDB.</p>
<h2 id="where-to-put-your-load-balancer">Where to put your load balancer</h2>
<p>For software-based load balancers, you can put your load balancer on the same host as your application or on separate hosts. Both have their benefits.</p>
<p>Installing the load balancer on the same host as a <em>sidecar</em> to your application is good for performance because it doesn't need an extra network hop. However, you'll have to administer many instances of your load balancing software which makes this slightly more complicated.</p>
<p>Installing the load balancer on separate hosts typically increases latency because you need an extra network hop. Depending on your network, there is also a risk that connectivity to and from the load balancer could become saturated. However, compared to the sidecar approach, this method is less complicated to administer.</p>
<p>When you're deciding between these options, high availability is also an important consideration. With the first setup, an unavailable load balancer only impacts a single application host. With the second solution, you probably have to take some steps to make your load balancer software highly available, which complicates the configuration.</p>
<h2 id="testing-load-balancing">Testing load balancing</h2>
<p>Before you deploy load balancing in production, you should first test the configuration to make sure everything works as expected. You should also test bigger configuration changes, upgrades, and other maintenance tasks before you do these on a production setup.</p>
<p>You can perform local testing with <code>tiup playground --db 2</code>. This gives you two TiDB instances, which allow you to see how connections switch from one to the other while testing.</p>
<p>When you connect via a load balancer, you might want to use this query to check on which instance you landed:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">@</span><span style="color:#f92672">@</span>hostname, <span style="color:#f92672">@</span><span style="color:#f92672">@</span>port
</code></pre></div><p>When you use <code>mysql -h localhost...</code>, <code>mysql</code> will try to connect over a UNIX socket even if a TCP port is provided. Depending on your configuration, this might not work. Instead, use <code>mysql -h 127.0.0.1...</code> to ensure the connection uses TCP.</p>
<div class="trackable-btns">
    <a href="/download" onclick="trackViews('Best Practices for TiDB Load Balancing', 'download-tidb-btn-middle')"><button>Get TiDB Now</button></a>
    <a href="/contact-us" onclick="trackViews('Best Practices for TiDB Load Balancing', 'contact-us-middle')"><button>Request a Demo</button></a>
</div>
<h2 id="configuration-examples">Configuration examples</h2>
<p>This section includes configuration examples for some of the most popular load balancing solutions with TiDB.</p>
<h3 id="proxysql">ProxySQL</h3>
<p>ProxySQL is an open-source, high-performance proxy for the MySQL protocol. ProxySQL knows the MySQL protocol; this brings a lot of MySQL-specific features like query caching and query rewriting.</p>
<p>The first step is to install ProxySQL. For more details and instructions for other platforms, see <a href="https://proxysql.com/documentation/installing-proxysql/">Download and Install ProxySQL</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo dnf install proxysql
</code></pre></div><p>To configure ProxySQL, you can either use the configuration file (<code>/etc/proxysql.cnf</code>) or the admin interface. The admin interface uses the MySQL protocol and is available on port 6032. The default credentials are <code>'admin'/'admin'</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mysql -h 127.0.0.1 -P <span style="color:#ae81ff">6032</span> -u admin -padmin --prompt <span style="color:#e6db74">&#39;admin&gt; &#39;</span>
</code></pre></div><p>The next step is to tell ProxySQL about the TiDB servers:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">admin&gt; INSERT INTO mysql_servers(hostgroup_id, hostname, port) VALUES (1, &#39;127.0.0.1&#39;, 4000);
Query OK, 1 row affected (0.00 sec)

admin&gt; INSERT INTO mysql_servers(hostgroup_id, hostname, port) VALUES (1, &#39;127.0.0.1&#39;, 4001);
Query OK, 1 row affected (0.00 sec)

admin&gt; LOAD MYSQL SERVERS TO RUNTIME;
Query OK, 0 rows affected (0.00 sec)

admin&gt; SAVE MYSQL SERVERS TO DISK;
Query OK, 0 rows affected (0.04 sec)
</code></pre></div><p>By default, ProxySQL uses an account called &lsquo;monitor&rsquo; to test connectivity to backend servers. So now create this user. The username and password for this user are set in ProxySQL via the <em>mysql-monitor_username</em> and <em>mysql-monitor_password</em> variables, so you can change this if you want.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">tidb<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">monitor</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%</span><span style="color:#e6db74">&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">monitor</span><span style="color:#e6db74">&#39;</span>;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">06</span> sec)
</code></pre></div><p>Now add a user to ProxySQL that matches the default &lsquo;root&rsquo; user that is available in a <code>tiup playground</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">admin</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> mysql_users(username,password,default_hostgroup) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">root</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span>,<span style="color:#ae81ff">1</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

<span style="color:#66d9ef">admin</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">LOAD</span> MYSQL USERS <span style="color:#66d9ef">TO</span> RUNTIME;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

<span style="color:#66d9ef">admin</span><span style="color:#f92672">&gt;</span> SAVE MYSQL USERS <span style="color:#66d9ef">TO</span> DISK;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">04</span> sec)
</code></pre></div><p>Now try to connect:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ mysql -h 127.0.0.1 -P 6033 -u root -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 8
Server version: 5.5.30 (ProxySQL)
Copyright (c) 2000, 2021, Oracle and/or its affiliates.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

mysql&gt; select version();
+--------------------+
| version()          |
+--------------------+
| 5.7.25-TiDB-v5.0.0 |
+--------------------+
1 row in set (0.00 sec)
</code></pre></div><p>The default port for application traffic for ProxySQL is 6033 (3306 in reverse!).</p>
<p>If you don't want to use query routing or query caching, you might want to enable fast_forward which is set in the <code>mysql_users</code> table. This reduces the amount of work the proxy has to do for each connection, which slightly lowers the latency.</p>
<h3 id="haproxy">HAProxy</h3>
<p>HAProxy is a high-performance load balancer that is mostly known for HTTP load balancing. However, you can also use it as a TCP load balancer. Besides a basic health check, it doesn't know about the MySQL Protocol.</p>
<p>Begin with installing HAProxy:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo dnf install haproxy
</code></pre></div><p>Then configure HAProxy by editing <code>/etc/haproxy/haproxy.cfg</code> and adding:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">listen tidb
    mode tcp
    bind 127.0.0.1:3306
    balance leastconn
    option mysql-check user root
    server tidb1 127.0.0.1:4000 check
    server tidb2 127.0.0.1:4001 check
frontend stats
    bind 127.0.0.1:8080
    stats enable
    stats uri /
    stats refresh 10s
    stats admin if LOCALHOST
</code></pre></div><p>This adds a tidb-service with two backend servers. This will route connections to the server with the least amount of connections. This enables a MySQL protocol-specific check to see if backend servers are healthy.</p>
<p>The <code>stats</code> part is optional and enables a web interface to see statistics and manage servers.</p>
<p>Here <code>127.0.0.1</code> was used to bind to localhost only. If you want to allow external connections, use <code>bind ::3306</code>.</p>
<p>On systems with SELinux enabled, the 3306 TCP port is labeled as <code>mysqld_port_t</code>. To allow HAProxy to use this port, do the following. If SELinux is not enabled, you can skip this step.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo setsebool -P haproxy_connect_any <span style="color:#ae81ff">1</span>
</code></pre></div><p>Now start HAProxy:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo systemctl enable haproxy --now
</code></pre></div><p>See also <a href="https://docs.pingcap.com/tidb/stable/haproxy-best-practices">Best Practices for Using HAProxy in TiDB</a>.</p>
<h3 id="mysql-router">MySQL Router</h3>
<p>MySQL Router is an open-source load balancing solution for the MySQL protocol from the MySQL team at Oracle.</p>
<p>First, install MySQL Router. Follow the <a href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-installation.html">instructions from the documentation</a> for your platform of choice. For this example, I'm using Linux.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo rpm -ivh https://dev.mysql.com/get/mysql80-community-release-fc34-1.noarch.rpm
sudo dnf install mysql-router
</code></pre></div><p>Now configure the router by adding the following to <code>/etc/mysqlrouter/mysqlrouter.conf</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">routing</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#a6e22e">tidb</span>]
<span style="color:#a6e22e">bind_address</span> = <span style="color:#ae81ff">127.0</span>.<span style="color:#ae81ff">0.1</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">6446</span>
<span style="color:#a6e22e">routing_strategy</span> = <span style="color:#a6e22e">round</span><span style="color:#960050;background-color:#1e0010">-</span><span style="color:#a6e22e">robin</span>
<span style="color:#a6e22e">protocol</span> = <span style="color:#a6e22e">classic</span>
<span style="color:#a6e22e">destinations</span> = <span style="color:#ae81ff">127.0</span>.<span style="color:#ae81ff">0.1</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">4000</span>, <span style="color:#ae81ff">127.0</span>.<span style="color:#ae81ff">0.1</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">4001</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo systemctl enable mysqlrouter --now
</code></pre></div><p>Note: Because TiDB does not support the <a href="https://github.com/pingcap/tidb/issues/1109">X Protocol</a>, you need to use <code>protocol = classic</code>.</p>
<h3 id="mysql-connectorj">MySQL Connector/J</h3>
<p>MySQL Connector/J is the JDBC Driver that implements the MySQL protocol for Java and other JVM-based languages.</p>
<p>MySQL Connector/J supports various kinds of <a href="https://dev.mysql.com/doc/connectors/en/connector-j-multi-host-connections.html">Multi-Host Connections</a>. In this example, I use the <code>loadbalance</code> option. This configuration distributes the load over multiple TiDB servers. When a failover happens, it tries to use the first host from the list, resulting in an uneven distribution of the load.</p>
<p>Because <a href="https://github.com/pingcap/tidb/issues/1109">TiDB doesn't support the X Protocol</a>, you cannot use the Connector/J <code>X Dev API</code> connection type with TiDB.</p>
<p>This is an example with MySQL Connector/J 8.0.24:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">com</span>.<span style="color:#a6e22e">pingcap</span>.<span style="color:#a6e22e">tidb_demo_java</span>;
<span style="color:#f92672">import</span> <span style="color:#a6e22e">java</span>.<span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Connection</span>;
<span style="color:#f92672">import</span> <span style="color:#a6e22e">java</span>.<span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">DriverManager</span>;
<span style="color:#f92672">import</span> <span style="color:#a6e22e">java</span>.<span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">SQLException</span>;
<span style="color:#f92672">import</span> <span style="color:#a6e22e">java</span>.<span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Statement</span>;
<span style="color:#f92672">import</span> <span style="color:#a6e22e">java</span>.<span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">ResultSet</span>;
<span style="color:#a6e22e">public</span> <span style="color:#a6e22e">class</span> <span style="color:#a6e22e">App</span>
{
    <span style="color:#a6e22e">public</span> <span style="color:#a6e22e">static</span> <span style="color:#a6e22e">void</span> <span style="color:#a6e22e">main</span>( <span style="color:#a6e22e">String</span>[] <span style="color:#a6e22e">args</span> )
    {
        <span style="color:#a6e22e">try</span> {
                <span style="color:#a6e22e">Class</span>.<span style="color:#a6e22e">forName</span>(<span style="color:#e6db74">&#34;com.mysql.cj.jdbc.Driver&#34;</span>).<span style="color:#a6e22e">newInstance</span>();
        } <span style="color:#a6e22e">catch</span> (<span style="color:#a6e22e">Exception</span> <span style="color:#a6e22e">ex</span>) {
                <span style="color:#a6e22e">System</span>.<span style="color:#a6e22e">out</span>.println(<span style="color:#e6db74">&#34;Failed to load driver: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ex</span>.<span style="color:#a6e22e">getMessage</span>());
        }
        <span style="color:#a6e22e">try</span> {
                <span style="color:#a6e22e">Connection</span> <span style="color:#a6e22e">conn</span> = <span style="color:#a6e22e">DriverManager</span>.<span style="color:#a6e22e">getConnection</span>(<span style="color:#e6db74">&#34;jdbc:mysql:loadbalance://127.0.0.1:4000,127.0.0.1:4001?user=root&#34;</span>);
                <span style="color:#a6e22e">Statement</span> <span style="color:#a6e22e">stmt</span> = <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">createStatement</span>();
                <span style="color:#a6e22e">ResultSet</span> <span style="color:#a6e22e">rs</span> = <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">executeQuery</span>(<span style="color:#e6db74">&#34;SELECT @@hostname, @@port&#34;</span>);
                <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">next</span>();
                <span style="color:#a6e22e">System</span>.<span style="color:#a6e22e">out</span>.println(<span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">getString</span>(<span style="color:#e6db74">&#34;@@hostname&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">getString</span>(<span style="color:#e6db74">&#34;@@port&#34;</span>));
        } <span style="color:#a6e22e">catch</span> (<span style="color:#a6e22e">SQLException</span> <span style="color:#a6e22e">ex</span>) {
                <span style="color:#a6e22e">System</span>.<span style="color:#a6e22e">out</span>.println(<span style="color:#e6db74">&#34;SQLException: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ex</span>.<span style="color:#a6e22e">getMessage</span>());
        }
    }
}
</code></pre></div><p>For more details about how to use TiDB with Java applications, see <a href="https://docs.pingcap.com/tidb/stable/java-app-best-practices">Best Practices for Developing Java Applications with TiDB</a>.</p>
<h3 id="mysql-connectorpython">MySQL Connector/Python</h3>
<p>MySQL Connector/Python is the official MySQL driver for Python. There are also other commonly-used MySQL drivers for Python, but they don't support the load balancing configuration that is described here.</p>
<p>This example uses MySQL Connector/Python 8.0.24 (<code>mysql-connector-python==8.0.24</code> according to <code>pip freeze output</code>).</p>
<p>To install this connector, see <a href="https://dev.mysql.com/doc/connector-python/en/connector-python-installation.html">Connector/Python Installation</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/python3</span>
<span style="color:#f92672">import</span> mysql.connector

config <span style="color:#f92672">=</span> {
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">failover</span><span style="color:#e6db74">&#34;</span>: [
        {<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">host</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">127.0.0.1</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">port</span><span style="color:#e6db74">&#34;</span>: <span style="color:#ae81ff">4000</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">user</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">root</span><span style="color:#e6db74">&#34;</span>},
        {<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">host</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">127.0.0.1</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">port</span><span style="color:#e6db74">&#34;</span>: <span style="color:#ae81ff">4001</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">user</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">root</span><span style="color:#e6db74">&#34;</span>},
    ],
}

<span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
    c <span style="color:#f92672">=</span> mysql<span style="color:#f92672">.</span>connector<span style="color:#f92672">.</span>connect(<span style="color:#f92672">*</span><span style="color:#f92672">*</span>config)
    cur <span style="color:#f92672">=</span> c<span style="color:#f92672">.</span>cursor()
    cur<span style="color:#f92672">.</span>execute(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">select @@hostname, @@port</span><span style="color:#e6db74">&#34;</span>)
    <span style="color:#66d9ef">print</span>(cur<span style="color:#f92672">.</span>fetchone())
    cur<span style="color:#f92672">.</span>close()
    c<span style="color:#f92672">.</span>close()
</code></pre></div><p>This outputs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">(&#39;myserver1&#39;, 4001)
(&#39;myserver1&#39;, 4000)
(&#39;myserver1&#39;, 4001)
(&#39;myserver1&#39;, 4001)
(&#39;myserver1&#39;, 4000)
</code></pre></div><h3 id="amazon-elb">Amazon ELB</h3>
<p>Amazon ELB is the load balancing service for the Amazon Web Services (AWS) cloud.</p>
<p>You can create the load balancer manually with the AWS EC2 Dashboard (as shown below) or by using automation like CloudFormation. When you use Amazon Elastic Kubernetes Service (EKS), deploying a load balancer is part of the deployment.</p>
<p><img src="media/aws-ec2-create-network-load-balancer.png" alt="AWS EC2 Create Network Load Balancer"></p>
<div class="caption-center">AWS EC2 Create Network Load Balancer</div>
<ol>
<li>Choose &ldquo;Network Load Balancer&rdquo; for the load balancer type. Depending on your requirements you need to select &ldquo;Internet-facing&rdquo; or &ldquo;Internal&rdquo;.</li>
<li>Configure the listener to use TCP Port 3306 or 4000.</li>
<li>Create a target group with the IP addresses of your TiDB instances. Depending on the port you have configured for TiDB, choose port 3306 or 4000.</li>
</ol>
<p>Make sure that the security group of your TiDB machines allows access from your load balancer. You should configure the load balancer security group to allow access from your applications, but restrict access from the rest of the internet.</p>
<p>For details, see <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/network-load-balancer-getting-started.html">Getting started with Network Load Balancers</a>.</p>
<h2 id="advanced-configuration">Advanced configuration</h2>
<p>If your servers have a different hardware configuration (for example,  more memory and CPUs) then you might want to exclude specific servers from your load balancer pool or create a separate load balancer pool. This can be used to separate analytical or data loading tasks.</p>
<h2 id="automation">Automation</h2>
<p>To automate operations like adding or removing instances, you might want to use the <a href="https://github.com/pingcap/tidb/blob/master/docs/tidb_http_api.md">TiDB HTTP API</a>.</p>
<p>If you don't want to put all your servers in your load balancer pool, you can use the HTTP API and filter on the server labels.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">curl -s http://127.0.0.1:10080/info/all | jq <span style="color:#e6db74">&#39;.all_servers_info&#39;</span>

<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;431ccb25-24a6-4311-b48d-613cac401b22&#34;</span>: <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;5.7.25-TiDB-v5.0.1&#34;</span>,
    <span style="color:#e6db74">&#34;git_hash&#34;</span>: <span style="color:#e6db74">&#34;1145e347d3469d8e89f88dce86f6926ca44b3cd8&#34;</span>,
    <span style="color:#e6db74">&#34;ddl_id&#34;</span>: <span style="color:#e6db74">&#34;431ccb25-24a6-4311-b48d-613cac401b22&#34;</span>,
    <span style="color:#e6db74">&#34;ip&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
    <span style="color:#e6db74">&#34;listening_port&#34;</span>: 4000,
    <span style="color:#e6db74">&#34;status_port&#34;</span>: 10080,
    <span style="color:#e6db74">&#34;lease&#34;</span>: <span style="color:#e6db74">&#34;45s&#34;</span>,
    <span style="color:#e6db74">&#34;binlog_status&#34;</span>: <span style="color:#e6db74">&#34;Off&#34;</span>,
    <span style="color:#e6db74">&#34;start_timestamp&#34;</span>: 1620024407,
    <span style="color:#e6db74">&#34;labels&#34;</span>: <span style="color:#f92672">{</span><span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;server_id&#34;</span>: <span style="color:#ae81ff">0</span>
  <span style="color:#f92672">}</span>,
  <span style="color:#e6db74">&#34;b830f979-c277-4e47-934e-87bb2063cf4d&#34;</span>: <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;5.7.25-TiDB-v5.0.1&#34;</span>,
    <span style="color:#e6db74">&#34;git_hash&#34;</span>: <span style="color:#e6db74">&#34;1145e347d3469d8e89f88dce86f6926ca44b3cd8&#34;</span>,
    <span style="color:#e6db74">&#34;ddl_id&#34;</span>: <span style="color:#e6db74">&#34;b830f979-c277-4e47-934e-87bb2063cf4d&#34;</span>,
    <span style="color:#e6db74">&#34;ip&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
    <span style="color:#e6db74">&#34;listening_port&#34;</span>: 4001,
    <span style="color:#e6db74">&#34;status_port&#34;</span>: 10081,
    <span style="color:#e6db74">&#34;lease&#34;</span>: <span style="color:#e6db74">&#34;45s&#34;</span>,
    <span style="color:#e6db74">&#34;binlog_status&#34;</span>: <span style="color:#e6db74">&#34;Off&#34;</span>,
    <span style="color:#e6db74">&#34;start_timestamp&#34;</span>: 1620024407,
    <span style="color:#e6db74">&#34;labels&#34;</span>: <span style="color:#f92672">{</span><span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;server_id&#34;</span>: <span style="color:#ae81ff">0</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="try-tidb-out">Try TiDB out</h2>
<p>To quickly get started with TiDB, refer to <a href="https://docs.pingcap.com/tidb/stable/quick-start-with-tidb">our documentation</a>. If you have any questions or need our community support, feel free to <a href="https://slack.tidb.io/invite?team=tidb-community&amp;channel=everyone&amp;ref=pingcap-blog">join the TiDB community</a> on Slack. You can also <a href="https://github.com/pingcap/tidb">file an issue</a> on GitHub and report any problems you meet.</p>
</div>
                </div>
                <div class="article-toc"></div><div class="ssba-wrap">
    <div class="ssba">
        <a data-site="" class="ssba_twitter_share" href="http://twitter.com/share?url=https%3a%2f%2fidiks.com%2fblog%2fbest-practices-for-tidb-load-balancing%2f" target="_blank">
        
            <img src="/images/svgs/twitter-icon.svg" alt="Twitter icon" />
        </a>
        <a data-site="reddit" class="ssba_reddit_share" href="http://reddit.com/submit?url=https%3a%2f%2fidiks.com%2fblog%2fbest-practices-for-tidb-load-balancing%2f&title=Best%20Practices%20for%20TiDB%20Load%20Balancing" target="_blank">
        
            <img src="/images/svgs/reddit-icon.svg" alt="Reddit icon" />
        </a>
        <a data-site="" class="ssba_facebook_share" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fidiks.com%2fblog%2fbest-practices-for-tidb-load-balancing%2f" target="_blank">
        
            <img src="/images/svgs/facebook-icon.svg" alt="Fackbook icon" />
        </a>
        <a data-site="linkedin" class="ssba_linkedin_share" href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fidiks.com%2fblog%2fbest-practices-for-tidb-load-balancing%2f" target="_blank">
        
            <img src="/images/svgs/linkedin-icon.svg" alt="Linkedin icon" />
        </a>
        <a data-site="hackernews" class="ssba_hackernews_share" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fidiks.com%2fblog%2fbest-practices-for-tidb-load-balancing%2f&t=Best%20Practices%20for%20TiDB%20Load%20Balancing" target="_blank">
        
            <img src="/images/svgs/hacker-news-icon.svg" alt="Hacker News icon" />
        </a>
    </div>
</div>
<div class="trackable-btns">
                    <a href="/download" onclick="trackViews('Best Practices for TiDB Load Balancing', 'download-tidb-btn-bottom')"><button>Download
                        TiDB</button></a>
                    <a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm"
                      onclick="trackViews('Best Practices for TiDB Load Balancing', 'subscribe-blog-btn-bottom')"><button>Subscribe to
                        Blog</button></a>
                </div>
            </div>
            <div class="sidebar-page">
                <div class="sticky-sidebar">
                    <p class="toc-title">What’s on this page</p>
                    <div id="smart_toc_wrapper"></div>
                </div>
            </div>
        </div>
    </div>
<footer>
    <div class="container">
        <div class="flex-list-wrap">
            <div class="flex-list">
                <h4 class="list-title"><strong>Product</strong></h4>
                <ul>
                <li><a href="/docs/v3.0/">TiDB</a></li>
                <li><a href="/docs/v3.0/reference/tispark/">TiSpark</a></li>
                <li><a href="/docs/v3.0/roadmap/">Roadmap</a></li>
                </ul>
            </div>
            <div class="flex-list">
                <h4 class="list-title"><strong>Docs</strong></h4>
                <ul>
                <li><a href="/docs/stable/quick-start-with-tidb/">Quick Start</a></li>
                <li><a href="/blog/2017-07-24-tidbbestpractice/">Best Practices</a></li>
                <li><a href="/docs/stable/faq/tidb/">FAQ</a></li>
                <li><a href="/docs/stable/reference/tools/user-guide/">TiDB Tools</a></li>
                <li><a href="/docs/dev/releases/rn/">Release Notes</a></li>
                </ul>
            </div>
            <div class="flex-list">
                <h4 class="list-title"><strong>Resources</strong></h4>
                <ul>
                <li><a href="/blog/">Blog</a></li>
                <li><a href="/weekly/">Monthly</a></li>
                <li><a href="https://github.com/idiks" target="_blank">GitHub</a></li>
                <li><a href="/community">TiDB Community</a></li>
                </ul>
            </div>
            <div class="flex-list">
                <h4 class="list-title"><strong>Company</strong></h4>
                <ul>
                <li><a href="/about/">About</a></li>
                <li><a href="/jobs" target="_blank">Careers</a></li>
                <li><a href="/news/">News</a></li>
                <li><a href="/contact-us/">Contact Us</a></li>
                <li><a href="/privacy-policy/">Privacy Policy</a></li>
                <li><a href="/terms-of-service/">Terms of Service</a></li>
                </ul>
            </div>
        </div>
        <div class="contact-list-wrap">
            <div class="flex-list">
                <h4 class="list-title"><strong>Connect</strong></h4>
                <ul>
                <li><a href="https://twitter.com/idiks" class="twitter" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" width="18" height="19"><path d="M612 116.258a250.714 250.714 0 0 1-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 0 1-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"/></svg> Twitter</a></li>
                <li><a href="https://www.linkedin.com/company/idiks/" class="linkedin" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 438.536 438.535"><path d="M5.424 145.895H99.64v282.932H5.424zM408.842 171.739c-19.791-21.604-45.967-32.408-78.512-32.408-11.991 0-22.891 1.475-32.695 4.427-9.801 2.95-18.079 7.089-24.838 12.419-6.755 5.33-12.135 10.278-16.129 14.844-3.798 4.337-7.512 9.389-11.136 15.104v-40.232h-93.935l.288 13.706c.193 9.139.288 37.307.288 84.508 0 47.205-.19 108.777-.572 184.722h93.931V270.942c0-9.705 1.041-17.412 3.139-23.127 4-9.712 10.037-17.843 18.131-24.407 8.093-6.572 18.13-9.855 30.125-9.855 16.364 0 28.407 5.662 36.117 16.987 7.707 11.324 11.561 26.98 11.561 46.966V428.82h93.931V266.664c-.007-41.688-9.897-73.328-29.694-94.925zM53.103 9.708c-15.796 0-28.595 4.619-38.4 13.848C4.899 32.787 0 44.441 0 58.529 0 72.42 4.758 84.034 14.275 93.358c9.514 9.325 22.078 13.99 37.685 13.99h.571c15.99 0 28.887-4.661 38.688-13.99 9.801-9.324 14.606-20.934 14.417-34.829-.19-14.087-5.047-25.742-14.561-34.973C81.562 14.323 68.9 9.708 53.103 9.708z"/></svg> LinkedIn</a></li>
                <li><a href="https://www.reddit.com/r/idiks/" class="reddit" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 279.748 279.748" width="18" height="18"><path d="M279.748 133.142c0-19.299-15.701-35-35-35-10.768 0-20.674 4.812-27.279 13.064-18.532-8.431-39.663-13.626-62.015-15.271l19.206-60.692 42.895 9.294c3.285 12.782 14.901 22.258 28.693 22.258 16.336 0 29.627-13.29 29.627-29.626 0-16.336-13.291-29.627-29.627-29.627-11.801 0-21.999 6.941-26.759 16.95l-49.497-10.725a10.002 10.002 0 0 0-11.651 6.756L134.636 95.43c-26.164.638-50.988 6.053-72.356 15.775-6.606-8.251-16.512-13.063-27.28-13.063-19.299 0-35 15.701-35 35 0 9.373 3.683 18.173 10.222 24.709-3.9 8.37-5.875 17.076-5.875 25.936 0 24.048 14.396 46.492 40.538 63.199 25.447 16.264 59.183 25.221 94.989 25.221 35.808 0 69.542-8.957 94.989-25.221 26.142-16.707 40.538-39.151 40.538-63.199 0-8.859-1.975-17.565-5.875-25.936 6.539-6.537 10.222-15.336 10.222-24.709zM15.369 145.139c-2.212-3.59-3.369-7.688-3.369-11.997 0-12.682 10.317-23 23-23 5.444 0 10.558 1.851 14.649 5.258-14.622 8.302-26.132 18.289-34.28 29.739zm52.671 20.266c0-13.785 11.215-25 25-25s25 11.215 25 25-11.215 25-25 25-25-11.215-25-25zm123.119 57.054c-9.745 10.637-29.396 17.244-51.285 17.244-21.888 0-41.539-6.607-51.284-17.244a9.937 9.937 0 0 1-2.617-7.192 9.933 9.933 0 0 1 3.235-6.937 9.974 9.974 0 0 1 6.754-2.627c2.797 0 5.484 1.183 7.373 3.244 5.803 6.333 20.827 10.756 36.539 10.756s30.737-4.423 36.539-10.756a10.022 10.022 0 0 1 7.374-3.244c2.508 0 4.906.933 6.755 2.627a9.928 9.928 0 0 1 3.234 6.937 9.933 9.933 0 0 1-2.617 7.192zm-4.451-32.054c-13.785 0-25-11.215-25-25s11.215-25 25-25 25 11.215 25 25-11.215 25-25 25zm77.671-45.266c-8.147-11.45-19.657-21.436-34.28-29.739 4.092-3.408 9.205-5.258 14.649-5.258 12.683 0 23 10.318 23 23 0 4.309-1.157 8.407-3.369 11.997z"/></svg>Reddit</a></li>
                <li><a href="https://groups.google.com/forum/#!forum/idiks-user" class="google-plus" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.858 491.858" width="18" height="20"><path d="M377.472 224.957H201.319v58.718H308.79c-16.032 51.048-63.714 88.077-120.055 88.077-69.492 0-125.823-56.335-125.823-125.824 0-69.492 56.333-125.823 125.823-125.823 34.994 0 66.645 14.289 89.452 37.346l42.622-46.328c-34.04-33.355-80.65-53.929-132.074-53.929C84.5 57.193 0 141.693 0 245.928s84.5 188.737 188.736 188.737c91.307 0 171.248-64.844 188.737-150.989v-58.718l-.001-.001zM491.858 224.857h-36.031v-36.031h-30.886v36.031H388.91v30.883h36.031v36.032h30.886V255.74h36.031z"/></svg>Google Group</a></li>
                <li><a href="https://stackoverflow.com/questions/tagged/idiks" class="stack-overflow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="17" viewBox="0 0 547.597 547.597"><path d="M140.81 475.111h.024l189.91-.269c8.434-.013 15.3-6.886 15.3-15.318v-21.298c0-8.428-6.854-15.288-15.3-15.288l-189.91.264c-8.433.012-15.3 6.885-15.3 15.318v21.31c.001 8.427 6.855 15.281 15.276 15.281z"/><path d="M58.667 517.854c.073 29.26.073 29.449 3.072 29.449h.055l10.612.294h.086s85.814 0 171.629-.036c42.914-.019 85.821-.05 118-.092 16.09-.019 29.505-.043 38.887-.074 17.803-.055 17.803-.055 17.803-3.072l.3-10.697V333.299c0-8.434-6.866-15.3-15.3-15.3h-11.909c-8.434 0-15.3 6.866-15.3 15.3V496.22c0 5.062-4.119 9.18-9.181 9.18H110.51c-5.061 0-9.18-4.118-9.18-9.18V333.299c0-8.434-6.867-15.3-15.3-15.3H73.82c-8.433 0-15.3 6.86-15.3 15.3 0 23.342.012 76.084.055 122.981.019 23.447.05 45.442.092 61.574z"/><path d="M142.322 397.399l189.402 17.467c.478.043.948.062 1.413.062 7.956 0 14.468-5.985 15.159-13.917l1.83-21.096c.729-8.396-5.508-15.851-13.898-16.628l-189.102-17.461c-8.593-.795-15.869 5.441-16.653 13.825l-1.97 21.108a15.172 15.172 0 0 0 3.452 11.181 15.19 15.19 0 0 0 10.367 5.459zM437.636 208.849a15.253 15.253 0 0 0 17.694 12.443l21.065-3.678c8.311-1.451 13.898-9.395 12.454-17.706l-32.504-187.23c-1.42-8.207-9.21-13.917-17.692-12.448l-21.065 3.678c-8.311 1.451-13.898 9.395-12.454 17.705l32.502 187.236zM190.333 194.375l163.6 96.708a15.28 15.28 0 0 0 7.778 2.136c5.393 0 10.447-2.876 13.183-7.509l10.876-18.36c2.08-3.519 2.674-7.631 1.658-11.591a15.18 15.18 0 0 0-7.032-9.358l-163.6-96.714c-7.014-4.149-16.836-1.597-20.967 5.374l-10.869 18.36a15.2 15.2 0 0 0-1.658 11.591 15.21 15.21 0 0 0 7.031 9.363zM387.525 240.501a15.276 15.276 0 0 0 12.626 6.659c3.091 0 6.077-.924 8.635-2.681l17.405-11.934c6.953-4.768 8.752-14.314 4.015-21.292L323.29 54.104c-4.584-6.732-14.498-8.623-21.236-3.984l-17.737 12.21c-6.945 4.779-8.727 14.327-3.971 21.291l107.179 156.88zM154.482 302.319l183.465 49.156c1.298.349 2.632.526 3.966.526 6.903 0 12.98-4.67 14.762-11.347l5.508-20.624c2.179-8.152-2.681-16.555-10.826-18.74l-183.465-49.162c-8.017-2.148-16.604 2.852-18.728 10.826l-5.508 20.63c-2.179 8.142 2.68 16.551 10.826 18.735z"/></svg>Stack Overflow</a></li>
                </ul>
            </div>
            <div class="subscribe">
                <a href="https://share.hsforms.com/1e2W03wLJQQKPd1d9rCbj_Q2npzm"><button class="btn btn-subscribe f-tc">Subscribe to Blog</button></a>
            </div>
        </div>
    </div>
    <div class="container copyright-container">
        <p class="copyright">&copy; 2025 iDIKS. All Rights Reserved.</p>
        <a href="/blog-cn" class="copyright-btn-lang" id="lang">中文</a>
    </div>
</footer>
<button class="back-to-top" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 284.929 284.929"><path d="M282.082 195.285L149.028 62.24c-1.901-1.903-4.088-2.856-6.562-2.856s-4.665.953-6.567 2.856L2.856 195.285C.95 197.191 0 199.378 0 201.853c0 2.474.953 4.664 2.856 6.566l14.272 14.271c1.903 1.903 4.093 2.854 6.567 2.854s4.664-.951 6.567-2.854l112.204-112.202 112.208 112.209c1.902 1.903 4.093 2.848 6.563 2.848 2.478 0 4.668-.951 6.57-2.848l14.274-14.277c1.902-1.902 2.847-4.093 2.847-6.566.001-2.476-.944-4.666-2.846-6.569z" fill="#FFF"/></svg>
</button>
</div><div class="overlay"></div><script src="https://static.idiks.com/js/jquery.min.js"></script><script type="text/javascript" src="/js/vendor/lazyload.min.js"></script>
    <script type="text/javascript" src="/js/doc.js"></script>
    <script type="text/javascript" src="/js/anchor.js"></script><script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script src="https://browser.sentry-cdn.com/5.11.0/bundle.min.js" integrity="sha384-jbFinqIbKkHNg+QL+yxB4VrBC0EAPTuaLGeRT0T+NfEV89YC6u1bKxHLwoo+/xxY" crossorigin="anonymous"></script><script>Sentry.init({ 
            dsn: 'https://3f28ed393c5545daa74496b3cdb2e9ba@sentry.io/1887163' 
        });</script><script src="/js/app.js"></script></body></html>